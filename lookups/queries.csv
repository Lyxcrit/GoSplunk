Title,Author,Category,Description,Query,Published,Modified
Logon Types within a Windows Environment (with logon count) -,Go Splunk,WinEventLog:Security,This query will identify logon types within a windows environment and list the number of logons associated with each type. ,"'source=""WinEventLog:security"" | eval LogonType=case(Logon_Type=""2"", ""Local Console Access"", Logon_Type=""3"", ""Accessing Network Folders or Files"", Logon_Type=""4"", ""Scheduled Task, Batch File, or Script"", Logon_Type=""5"", ""Service Account"", Logon_Type=""7"", ""Local Console Unlock"", Logon_Type=""8"", ""Network User Logon"", Logon_Type=""9"", ""Program launched with RunAs using /netonly switch"", Logon_Type=""10"", ""Remote Desktop via Terminal Services"", Logon_Type=""11"", ""Mobile Access or Network Domain Connection Resumed"") | top limit=15 LogonType | eval percent = round(percent,2) . "" %""'",2014-10-07T13:14:36+00:00,2014-10-07T14:36:17+00:00
Number of Accounts Created in a Windows Environment -,Go Splunk,WinEventLog:Security,Account Creation Gauge used to indicate number of accounts created in a Windows environment. EventCodes (EventID&#8217;s) used are for server 2003/XP and newer. Modify the gauge to fit your environment&#8217;s needs. ,"'sourcetype=WinEventLog:Security (EventCode=624 OR EventCode=4720) | eval NewAccount=case(EventCode=624, ""New Account Created"", EventCode=4720, ""New Account Created"") | stats count(NewAccount) as creation | gauge creation 1 5 15 25'",2014-10-07T14:40:59+00:00,
Gauge of Windows Successful Logons -,Go Splunk,WinEventLog:Security,Gauge of Windows Successful Logons. Adjust the gauge to meet your needs. ,"'source=""WinEventLog:security"" (EventCode=528 OR EventCode=540 OR EventCode=4624) | stats count(user) as Success_Logon | gauge Success_Logon 1 1000'",2014-10-07T14:41:59+00:00,
Gauge of Windows Failed Logons -,Go Splunk,WinEventLog:Security,Gauge of Windows Failed Logons. Adjust the gauge to meet your environments needs. ,"'sourcetype=""WinEventLog:Security"" (""EventCode=4625"") OR (""EventCode=529"" OR ""EventCode=530"" OR ""EventCode=531"" OR ""EventCode=532"" OR ""EventCode=533"" OR ""EventCode=534"" OR ""EventCode=535"" OR ""EventCode=536"" OR ""EventCode=537"" OR ""EventCode=539"") (Logon_Type=*) | stats count(user) as Failed_Logon | gauge Failed_Logon 1 25 50 150'",2014-10-07T14:43:33+00:00,
Escalation of Privileges in a Windows Environment by User -,Go Splunk,WinEventLog:Security,Escalation of Privileges in a Windows Environment by user. ,"'sourcetype=""WinEventLog:Security"" (EventCode=576 OR EventCode=4672 OR EventCode=577 OR EventCode=4673 OR EventCode=578 OR EventCode=4674) | stats count by user'",2014-10-07T14:45:07+00:00,
Password changes in a Windows environment by user account -,Go Splunk,WinEventLog:Security,Password changes in a Windows environment by user account. ,"'sourcetype=""WinEventLog:Security"" (EventCode=628 OR EventCode=627 OR EventCode=4723 OR EventCode=4724) | chart count by user'",2014-10-07T14:47:41+00:00,2014-10-07T14:48:02+00:00
Accounts Deleted via EventID&#039;s that Correspond with Post XP/2003 Operating Systems -,Go Splunk,WinEventLog:Security,"This query will search for accounts deleted via EventID&#8217;s that correspond with post XP/2003 operating systems. It will output the admin account, account deleted, details about the action, and the machine that the account deletion took place on. ","'sourcetype=WinEventLog:Security (EventCode=630) |eval Date=strftime(_time, ""%Y/%m/%d"")| stats count by User, Target_Account_Name, name, host, index Date | rename User as ""Administrator Account"" | rename Target_Account_Name as ""Account Name Deleted"" | rename name as ""Detailed Information"" |rename host as ""Computer the Account was Created on"" | rename index as ""Index of origin""| sort - Date', u'Target_User_Name_as_user,Primary_User_Name_as_user,Target_Account_Name_as_user,New_Account_Name_as_user,Account_Name_as_user,User_Name_as_user,User_as_user'",2014-10-07T14:50:38+00:00,
Security Access granted to an Account -,SplunkNinja,WinEventLog:Security,Like most windows security logs there are two formats depending on which version of windows you are running. The query for a Windows 7 / Server 2008 and newer looks like this: ,"'sourcetype=""WinEventLog:Security"" EventCode=4717 | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by src_user, user, Access_Right, Date, Keywords |rename src_user as ""Source Account"" | rename user as ""Target Account"" | rename Access_Right as ""New Rights Granted""', u'sourcetype=""WinEventLog:Security"" EventCode=621 Account_Modified!=""%{*"" | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by User_Name, Account_Modified, Access_Granted, Date, action |rename User_Name as ""Source Account"" | rename Account_Modified as ""Target Account"" | rename Access_Granted as ""New Rights Granted""'",2014-10-31T13:25:29+00:00,
System Security Access Removed from Account -,SplunkNinja,WinEventLog:Security,The following queries will list security access that was removed from an account in a Windows environment. Queries look different depending on which version of Windows you are running as the syntax and the EventID&#8217;s changed after 2003. Windows Server 2008 and newer: ,"'sourcetype=""WinEventLog:Security"" EventCode=4718 | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by src_user, user, Access_Right, Date, Keywords |rename src_user as ""Source Account"" | rename user as ""Target Account"" | rename Access_Right as ""Rights Removed""', u'sourcetype=""WinEventLog:Security"" EventCode=622 Account_Modified!=""%{*"" | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by User_Name, Account_Modified, Access_Removed, Date, action |rename User_Name as ""Source Account"" | rename Account_Modified as ""Target Account"" | rename Access_Removed as ""Rights Removed""'",2014-10-31T13:25:29+00:00,
Console Lock Duration -,SplunkNinja,WinEventLog:Security,The following code works only in windows 2008 and newer operating systems: ,"'sourcetype=WinEventLog:Security (EventCode=4800 OR EventCode=4801) | eval Date=strftime(_time, ""%Y/%m/%d"") | transaction host Account_Name startswith=EventCode=4800 endswith=EventCode=4801 | eval duration = duration/60 | eval duration=round(duration,2)| table host, Account_Name, duration, Date |rename duration as ""Console Lock Duration in Minutes"" | sort - date'",2014-11-07T18:56:39+00:00,
Windows Power Off Duration -,SplunkNinja,WinEventLog:System,This query will indicate the time it took between a computer shutdown and a computer powering back on. Typically found in restarts and shutdowns. This would not occur during a hard-reset or loss of power. ,"'sourcetype=WinEventLog:System (EventCode=6005 OR EventCode=6006) | transaction host startswith=""EventCode=6006"" endswith=""EventCode=6005"" | eval restart_duration=tostring(duration,""duration"") | eval Date=strftime(_time, ""%Y/%m/%d"")| where duration &gt; 480 | table host index Date restart_duration | sort - Date | rename restart_duration as ""Restart Duration""'",2014-11-10T15:29:31+00:00,2014-11-10T15:34:00+00:00
Time between rights granted and rights revoked -,SplunkNinja,WinEventLog:Security,"This query outputs a table that indicates the time difference between Rights granted and Rights revoked. Modify the maxspan time within the transaction function to meet your environments needs. Regex is used here, and is part of the query. Windows 2008 and newer: ","'sourcetype=WinEventLog:Security (EventCode=4717 OR EventCode=4718) | rex ""Access\\sGranted:\\s+Access\\sRight:\\s+(?\\w+)""| rex ""Access\\sRemoved:\\s+Access\\sRight:\\s+(?\\w+)""| eval Rights=coalesce(RightGranted,RightRemoved) | eval status=case(EventCode=4717, ""New Rights Granted by:"", EventCode=4718, ""Rights Removed by:"")| transaction Rights user startswith=""Granted"" endswith=""Removed"" |where duration &gt; 0| eval duration = duration/60 |eval n=round(duration,2) | eval Date=strftime(_time, ""%Y/%m/%d"") | table Date, host, status, Security_ID, user, Rights, n |rename Security_ID as ""Source Account"" | rename user as ""Target Account"" | rename n as ""Minutes between Rights Granted Then Removed"" | sort - date', u'sourcetype=WinEventLog:Security (EventCode=608 OR EventCode=609) | rex ""Message=User\\sRight\\sAssigned:\\s+User\\sRight:\\s+(?\\w+)""| rex ""Message=User\\sRight\\sRemoved:\\s+User\\sRight:\\s+(?\\w+)""| eval Rights=coalesce(RightGranted,RightRemoved) | eval status=case(EventCode=608, ""New Rights Granted by:"", EventCode=609, ""Rights Removed by:"")| transaction Rights user startswith=""Assigned"" endswith=""Removed"" |where duration &gt; 0| eval duration = duration/60 |eval n=round(duration,2) | eval Date=strftime(_time, ""%Y/%m/%d"") | table Date, host, status, User, user, Rights, n | rename User as ""Source Account"" | rename user as ""Target Account"" | rename n as ""Minutes between Rights Granted Then Removed"" | sort - date'",2014-11-10T20:30:48+00:00,
Windows Time Change -,SplunkNinja,WinEventLog:Security,"This query will list all users who initiated a time change. System accounts change time automatically, as such I&#8217;ve ignored system accounts from the query output. Windows 2008 and newer: ","'sourcetype=WinEventLog:Security EventCode=4616 Account_Name!=""*$"" Account_Name!=""LOCAL SERVICE""| stats count by Account_Name', u'sourcetype=WinEventLog:Security user!=""*$"" user!=""LOCAL SERVICE"" EventCode=520 | stats count by user'",2014-11-10T20:31:09+00:00,
Accounts Enabled -,ItsJohnLocke,WinEventLog:Security,This query will return results on all accounts enabled for a given time range. It is using EventCodes for windows 2008 and newer operating systems: ,"'sourcetype=WinEventLog:Security (EventCode=4722) | stats count by index, user, host, name'",2014-11-12T14:29:35+00:00,
Accounts Disabled -,ItsJohnLocke,WinEventLog:Security,This query will return results for accounts disabled on a windows 2008 or newer operating system for a given time range: ,"'sourcetype=WinEventLog:Security (EventCode=4725) | stats count by index, user, host, name'",2014-11-12T14:29:47+00:00,
Detailed list of Universal Forwarders Reporting to Indexer -,SplunkNinja,splunkd,The following query will list in detail information on the universal forwarders checking into the indexer. I&#8217;ve renamed some of the fields to be more user-friendly. ,"'index=_internal sourcetype=splunkd destPort!=""-""| stats sparkline count by hostname, sourceHost, host, destPort, version | rename destPort as ""Destination Port"" | rename host as ""Indexer"" | rename sourceHost as ""Universal Forwarder IP"" | rename version as ""Splunk Forwarder Version"" | rename hostname as ""Universal Forwarder Host Name"" | rename sparkline as ""Traffic Frequency"" | sort - count'",2014-11-13T14:52:51+00:00,
Total Number of Hosts reporting in. -,SplunkNinja,splunkd,This query will list the total number of hosts reporting to the indexer for any specified time range. This only works for universal forwarders. If you have hosts reporting in over syslog (typically port 514) they will not be listed. ,"'index=_internal sourcetype=splunkd | stats dc(hostname) as ""Number of Hosts""'",2014-11-13T19:00:47+00:00,
Microsoft AntiMalware Scan Completion -,SplunkNinja,WinEventLog:System,"This query lists a count by scan type, duration of scan, and the host the scan took place on. Modify as needed. ","'sourcetype=""WinEventLog:System"" SourceName=""Microsoft Antimalware"" EventCode=1001 | stats count by Scan_Type, Scan_Time, host'",2014-11-17T19:23:14+00:00,
Microsoft Antimalware Malware Detection Details -,SplunkNinja,WinEventLog:System,"This query will return results if malware is detected, and return detailed information on the Malware detected. ","'sourcetype=""WinEventLog:System"" SourceName=""Microsoft Antimalware""  EventCode=1116 |eval Date=strftime(_time, ""%Y/%m/%d"")| stats count by host, Category, Name, Path, Severity, Date'",2014-11-17T19:33:36+00:00,
Microsoft Antimalware Virus Remediation Details -,SplunkNinja,WinEventLog:System,This query will return detailed results on malware/virus remediation. ,"'sourcetype=""WinEventLog:System"" SourceName=""Microsoft Antimalware"" EventCode=1117 |eval Date=strftime(_time, ""%Y/%m/%d"")| stats count by host, Category, Name, Severity, Date, Action_Status'",2014-11-17T20:38:01+00:00,
Average CPU Usage on a Windows box -,SplunkNinja,Perfmon:CPU Load,This query will return the average CPU usage by minute. ,"'sourcetype=""Perfmon:CPU Load"" | bucket _time span=1m | stats avg(Value) by _time'",2014-11-17T20:52:11+00:00,2014-11-18T17:31:06+00:00
Available Disk Space on a Windows Box -,SplunkNinja,Perfmon:Free Disk Space,This splunk query will return available disk space in Gigabytes. ,"'sourcetype=""Perfmon:Free Disk Space"" | bucket _time span=1d | eval gigabytes=(Value/1024) | stats avg(gigabytes) by _time'",2014-11-18T17:51:52+00:00,
Median Duration of a Session within an IIS Web Environment -,Go Splunk,IIS,This query will report back the median duration of a session within an IIS web environment. The time format will be HH:MM:SS ,"'sourcetype=""iis"" | stats range(_time) as duration by JSESSIONID | stats median(duration) as AVD | fieldformat AVD=tostring(AVD,""duration"") | eval AVD=round(AVD, 0)'",2014-10-07T14:52:03+00:00,2014-11-18T17:53:58+00:00
Average Duration of a Session within an IIS Web Environment -,Go Splunk,IIS,This query will report back the average duration of a session within an IIS web environment. The time format will be HH:MM:SS ,"'sourcetype=""iis"" | stats range(_time) as duration by JSESSIONID | stats avg(duration) as AVG | fieldformat AVG=tostring(AVG,""duration"") | eval AVG=round(AVG, 0)'",2014-10-07T14:53:25+00:00,2014-11-18T17:54:22+00:00
Network Usage by KB per minute on a Windows Box -,SplunkNinja,Perfmon:Network Interface,The following query will return average network usage per minute by Kilobyte: ,"'sourcetype=""Perfmon:Network Interface"" | bucket _time span=1m | eval KB=(Value/1024) | stats avg(KB) by _time'",2014-11-18T18:04:03+00:00,2014-11-18T18:04:29+00:00
Real Time IIS Web Site Connections -,SplunkNinja,IIS,"Assuming JSESSIONID is auto-extracted, run the following REAL-TIME search (choose your window, I typically go with 5 minutes): ","'sourcetype=""iis"" | stats dc(JSESSIONID)'",2014-11-18T21:27:07+00:00,
Failed Login to OSX -,ItsJohnLocke,osx_secure,The following splunk query will return results on users who made unsuccessful attempts to login to an OSX machine: ,"'sourcetype=osx_secure | rex ""authinternal\\sfailed\\sto\\sauthenticate\\suser\\s(?\\S+)"" |eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by USER, host, Date | sort - count'",2014-11-20T13:33:16+00:00,
List of Source Names and Frequency of Events -,SplunkNinja,Uncategorized,The following splunk query will output a list of all SourceNames in a windows environment and include a sparkline to indicate frequency: ,"'eventtype=""windows_events"" sourcetype=""*EventLog:*"" (host=""*"" OR ComputerName=""*"") TaskCategory=""*""  SourceName=""*"" EventCode=""*"" Type=""*""  | stats sparkline as Activity, count by host | sort -count'",2014-12-01T18:46:30+00:00,
Weekend User Activity -,SplunkNinja,WinEventLog:Security,Run the following (modify user field as needed) to show weekend activity: ,"'sourcetype=""WinEventLog:Security"" (date_wday=saturday OR date_wday=sunday) | stats count by Account_Name, date_wday'",2015-01-19T19:43:39+00:00,
Failed Logins Windows -,SplunkNinja,WinEventLog:Security,Splunk query for all failed logon attempts within a windows environment. ,"'sourcetype=""WinEventLog:Security"" (""EventCode=4625"") OR (""EventCode=529"" OR ""EventCode=530"" OR ""EventCode=531"" OR ""EventCode=532"" OR ""EventCode=533"" OR ""EventCode=534"" OR ""EventCode=535"" OR ""EventCode=536"" OR ""EventCode=537"" OR ""EventCode=539"") '",2015-02-02T15:25:40+00:00,
Time between Account Creation and Account Deletion -,SplunkNinja,WinEventLog:Security,"Below is the query indicating time (duration) between account creation and account deletion. I have added a range to indicate severity, remove and modify as needed. Windows 2008 and newer: ","'sourcetype=WinEventLog:Security (EventCode=4726 OR EventCode=4720) |eval Date=strftime(_time, ""%Y/%m/%d"") |rex ""Subject:\\s+\\w+\\s\\S+\\s+\\S+\\s+\\w+\\s\\w+:\\s+(?&lt;SourceAccount&gt;\\S+)"" | rex ""Target\\s\\w+:\\s+\\w+\\s\\w+:\\s+\\S+\\s+\\w+\\s\\w+:\\s+(?&lt;DeletedAccount&gt;\\S+)"" | rex ""New\\s\\w+:\\s+\\w+\\s\\w+:\\s+\\S+\\s+\\w+\\s\\w+:\\s+(?&lt;NewAccount&gt;\\S+)"" | eval SuspectAccount=coalesce(DeletedAccount,NewAccount) | transaction SuspectAccount startswith=""EventCode=4720"" endswith=""EventCode=4726"" |eval duration=round(duration/60, 2) | eval Age=case(duration&lt;=240, ""Critical"", duration&gt;240 AND duration&lt;=1440, ""Warning"", duration&gt;1440, ""Normal"")| table Date, index, host, SourceAccount, SuspectAccount, duration, Age | rename duration as ""Minutes Account was Active"" |rename index as ""SSP or Index"" | sort + ""Minutes Account was Active""'",2015-02-13T15:32:27+00:00,
Failed Authentication to Non-existing Accounts -,SplunkNinja,WinEventLog:Security,This splunk query will return results for failed logon attempts to accounts that do not exist. This has been tested and confirmed on Windows Server 2008 and newer machines: ,"'\xa0source=""WinEventLog:security"" sourcetype=""WinEventLog:Security"" EventCode=4625 Sub_Status=0xC0000064 |eval Date=strftime(_time, ""%Y/%m/%d"") |rex ""Which\\sLogon\\sFailed:\\s+Security\\sID:\\s+\\S.*\\s+\\w+\\s\\w+\\S\\s.(?&lt;uacct&gt;\\S.*)"" | stats count by Date, uacct, host | rename count as ""Attempts"" | sort - Attempts'",2015-03-10T14:59:02+00:00,
File Accesses in a Windows Environment by user -,Go Splunk,WinEventLog:Security,File Accesses in a Windows Environment by user ,"'sourcetype=""WinEventLog:Security"" user=* (EventCode=560 OR EventCode=4656) | chart count by Type'",2014-10-07T14:46:47+00:00,2015-03-11T11:32:47+00:00
Account Modifications in a Windows Environment -,ItsJohnLocke,WinEventLog:Security,The following splunk query will give you all permission changes for each user. There are four queries. 1. Windows 2008 Permission Increases: ,"'\xa0sourcetype=WinEventLog:Security (EventCode=4717) | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Access\\sGranted:\\s+Access\\sRight:\\s+(?&lt;RightGranted&gt;\\w+)"" | rex ""Account\\sModified:\\s+\\w+\\s\\S+\\s+.*\\\\\\(?&lt;AccountModified&gt;.*)"" | stats count by Date, AccountModified, RightGranted, host | sort - Date', u'\xa0sourcetype=WinEventLog:Security (EventCode=4718) | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Access\\sRemoved:\\s+Access\\sRight:\\s+(?&lt;RightRemoved&gt;\\w+)""| rex ""Account\\sModified:\\s+\\w+\\s\\S+\\s+.*\\\\\\(?&lt;AccountModified&gt;.*)"" | stats count by Date, AccountModified, RightRemoved, host | sort - Date | rename RightRemoved as ""Rights Removed"" | rename AccountModified as ""Account Modified""', u'sourcetype=WinEventLog:Security EventCode=608 | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Message=User\\sRight\\sAssigned:\\s+User\\sRight:\\s+(?&lt;RightGranted&gt;\\w+)"" | rex ""Assigned\\sTo:\\s+.*\\\\\\(?&lt;AccountModified&gt;.*)"" | stats count by Date, AccountModified, RightGranted, host | sort - Date | rename RightGranted as ""Rights Granted"" | rename AccountModified as ""Account Modified""', u'sourcetype=WinEventLog:Security EventCode=609 | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Message=User\\sRight\\sRemoved:\\s+User\\sRight:\\s+(?&lt;RightRemoved&gt;\\w+)"" | rex ""Removed\\sFrom:\\s+.*\\\\\\(?&lt;AccountModified&gt;.*)"" | stats count by Date, AccountModified, RightRemoved, host | sort - Date | rename RightRemoved as ""Rights Removed"" | rename AccountModified as ""Account Modified""'",2015-03-11T14:37:06+00:00,
Accounts Deleted in a Windows Environment -,ItsJohnLocke,WinEventLog:Security,These splunk queries will return deleted accounts in Associated with Windows Environments (NOTE* The 2003 query requires that the splunk for windows app be installed): 2003: ,"'sourcetype=WinEventLog:Security (EventCode=630) | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Target_Account_Name, Caller_User_Name, Type, host | sort - Date | rename Target_Account_Name as ""Deleted Account"" | rename Caller_User_Name as ""Source Account"" | sort - Date', u'sourcetype=WinEventLog:Security (EventCode=4726) | eval Date=strftime(_time, ""%Y/%m/%d"") |rex ""Target\\sAccount:\\s+.*\\s+\\w+\\s\\w+:\\s+(?&lt;TargetAccount&gt;.*)"" | rex ""Account\\sName:\\s+(?&lt;SourceAccount&gt;.*)"" | stats count by Date, TargetAccount, SourceAccount, Keywords, host | sort - Date | rename TargetAccount as ""Deleted Account"" | rename SourceAccount as ""Source Account""'",2015-03-11T17:45:03+00:00,
Changes to Windows User Groups by Account -,SplunkNinja,WinEventLog:Security,This splunk query will return changes to any group in a windows environment. You MUST have the Splunk App for Windows Infrastructure\xa0app installed located here:\xa0https://apps.splunk.com/app/1680/ Windows Server 2003 and older: ,"'sourcetype=WinEventLog:Security (EventCode=636 OR EventCode=632 OR EventCode=650 OR EventCode=655 OR EventCode=660 OR EventCode=665) | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Caller_User_Name, Target_Account_Name, host, Type', u'sourcetype=WinEventLog:Security (EventCode=4728 OR EventCode=4732 OR EventCode=4746 OR EventCode=4751 OR EventCode=4756 OR EventCode=4161 OR EventCode=4185) | eval Date=strftime(_time, ""%Y/%m/%d"") |rex ""Member:\\s+\\w+\\s\\w+:.*\\\\\\(?&lt;TargetAccount&gt;.*)"" | rex ""Account\\sName:\\s+(?&lt;SourceAccount&gt;.*)"" | stats count by Date, TargetAccount, SourceAccount, Group_Name, host, Keywords | sort - Date | rename SourceAccount as ""Administrator Account"" | rename TargetAccount as ""Target Account""'",2015-03-13T12:34:54+00:00,
New Service Installation on Windows -,SplunkNinja,WinEventLog:Security,The following splunk query will return results of all new services installed on windows machines (this works on any windows OS tested thus far). Ensure the Splunk App for Windows is installed grab it here:\xa0https://apps.splunk.com/app/742/ ,"'\xa0sourcetype=WinEventLog:Security (EventCode=4697 OR EventCode=601) | eval Date=strftime(_time, ""%Y/%m/%d"") | eval Status=coalesce(Keywords,Type) |stats count by Date, Service_Name, Service_File_Name, Service_Account, host, Status'",2015-03-13T14:45:05+00:00,
Windows File Access Attempts -,SplunkNinja,WinEventLog:Security,The following splunk queries will display any file access attempts (successful or failed) by user account. Ensure the Splunk App for Windows is installed grab it here:\xa0https://apps.splunk.com/app/742/ Windows 2003 and older: ,"'sourcetype=""WinEventLog:Security"" EventCode=560 Object_Type=File | eval Date=strftime(_time, ""%Y/%m/%d"") |eval UserName=coalesce(Primary_User_Name, Client_User_Name)| search UserName!=""*$"" AND UserName!=""NETWORK SERVICE""| stats count by Date, Image_File_Name, UserName, Type, host | sort - Date', u'sourcetype=""WinEventLog:Security"" EventCode=4656 Object_Type=File (Security_ID!=""NT AUTHORITY*"") (Security_ID!=""S-*"")| eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Account_Name, Process_Name, Keywords, host'",2015-03-18T19:48:05+00:00,
File Deletion Attempts In Windows -,SplunkNinja,WinEventLog:Security,The following splunk queries will return results based on any user account who attempts to delete a file. This will return both successful and failed attempts. Ensure the Splunk App for Windows is installed grab it here:\xa0https://apps.splunk.com/app/742/ Windows 2003 and older: ,"'sourcetype=""WinEventLog:Security"" EventCode=564 |eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Image_File_Name, Type, host | sort - Date', u'sourcetype=""WinEventLog:Security"" EventCode=4660 (Security_ID!=""NT AUTHORITY*"") (Security_ID!=""S-*"")| eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Account_Name, Process_Name, Keywords, host'",2015-03-18T19:51:11+00:00,
Modification to File Permissions in Windows -,SplunkNinja,WinEventLog:Security,The following splunk query works on Windows Sever 2008 and newer operating systems. It returns results based on modifications to individual file level permissions. Ensure the Splunk App for Windows is installed grab it here:\xa0https://apps.splunk.com/app/742/ ,"'\xa0&lt;strong&gt;source=""WinEventLog:Security"" sourcetype=""WinEventLog:Security"" EventCode=4670 (Security_ID!=""NT AUTHORITY*"") (Security_ID!=""S-*"")| eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Account_Name, Process_Name, Keywords, host | sort - Date&lt;/strong&gt;'",2015-03-18T19:54:55+00:00,
Password Non Compliance Windows -,SplunkNinja,WinEventLog:Security,The following splunk queries will return results for failed attempts to change passwords. This is likely a result of users not meeting password requirements. Be sure to have the\xa0Splunk App for Windows is installed grab it here:\xa0https://apps.splunk.com/app/742/ Windows 2003 and Older: ,"'sourcetype=""WinEventLog:Security"" EventCode=627 Type=""Failure Audit""| eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Target_Account_Name, host | sort - Date', u'sourcetype=""WinEventLog:Security"" EventCode=4723 \xa0Keywords=""Audit Failure"" | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Target\\sAccount:\\s+Security\\sID:.*\\\\\\(?&lt;account&gt;\\S+)"" | stats count by Date, account, host | sort - Date'",2015-03-23T20:24:38+00:00,
Verify Windows Updates have been Applied -,SplunkNinja,WinEventLog:System,The following splunk query will return results on any Windows Updates (Patches) that have been applied by searching for the KB value associated with the EventID. &nbsp; ,"'sourcetype=WinEventLog:System EventCode=19 | eval Date=strftime(_time, ""%Y/%m/%d"")| rex ""\\WKB(?&lt;KB&gt;.\\d+)\\W"" |stats count by Date, host, KB'",2015-04-02T13:11:20+00:00,
Start a Windows Service -,SplunkNinja,WinEventLog:Application,This Splunk Query will return results for any Windows Service that has started. Ensure the Splunk App for Windows is installed grab it here:\xa0https://apps.splunk.com/app/742/ ,"'sourcetype=WinEventLog:Application EventCode=105 | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, SourceName, host | sort - Date | fields - count'",2015-04-06T22:38:02+00:00,2015-04-06T22:38:57+00:00
Shutdown or Suspend a Service in Windows -,SplunkNinja,WinEventLog:Application,This splunk query will return results for any Windows Service that has been stopped. Ensure the Splunk App for Windows is installed grab it here:\xa0https://apps.splunk.com/app/742/ ,"'sourcetype=WinEventLog:Application EventCode=108 | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, SourceName, host | sort - Date | fields - count'",2015-04-06T22:36:31+00:00,2015-04-06T22:39:15+00:00
Failed Attempt to Initiate Remote Desktop Session -,SplunkNinja,WinEventLog:Security,This splunk query will return any failed attempts initiated by users to launch an RDP (remote desktop) session in a Windows environment. Ensure the Splunk App for Windows is installed grab it here:\xa0https://apps.splunk.com/app/742/ Windows Server 2008 and Newer: ,"'source=WinEventLog:Security sourcetype=WinEventLog:security Logon_Type=10 EventCode=4625 | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Failed:\\s+.*\\s+Account\\sName:\\s+(?&lt;TargetAccount&gt;\\S+)\\s"" | stats count by Date, TargetAccount, Failure_Reason, host', u'source=WinEventLog:Security sourcetype=WinEventLog:security Logon_Type=10 (EventCode=529 OR EventCode=530 OR EventCode=531 OR EventCode=532 OR EventCode=533 OR EventCode=534 OR EventCode=535 OR EventCode=536 OR EventCode=537 OR EventCode=539) | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, User_Name, Reason, host'",2015-04-09T01:01:09+00:00,2015-04-09T01:02:33+00:00
Account Enabled in Windows -,SplunkNinja,WinEventLog:Security,The following Splunk queries will show any accounts that have been enabled from a previously disabled state. Ensure the Splunk App for Windows is installed grab it here:\xa0https://apps.splunk.com/app/742/ Windows Server 2008 and Newer: ,"'sourcetype=WinEventLog:Security (EventCode=4722) | eval Date=strftime(_time, ""%Y/%m/%d"") |rex ""ID:\\s+\\w+\\\\\\(?&lt;sourceaccount&gt;\\S+)\\s+"" | rex ""Account:\\s+Security\\sID:\\s+\\w+\\\\\\(?&lt;targetaccount&gt;\\S+)\\s+"" | stats count by Date, sourceaccount, targetaccount, Keywords, host | rename sourceaccount as ""Source Account"" | rename targetaccount as ""Target Account"" | sort - Date', u'sourcetype=WinEventLog:Security (EventCode=626) | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, Caller_User_Name, Target_Account_Name, Type, host | sort - Date'",2015-04-09T01:04:58+00:00,
USB and Removable Media Detection -,SplunkNinja,WinRegistry,This splunk query will show information about USB mass storage device uses. You must be monitoring the registry using the Windows Technology Add-on (TA). ,"'sourcetype=WinRegistry key_path=""HKLM\\\\system\\\\controlset*\\\\enum\\\\usbstor\\\\*"" \xa0registry_type=CreateKey | eval Date=strftime(_time, ""%Y/%m/%d %H:%M:%S"") | rex ""key_path.*usbstor\\S(?&lt;DeviceType&gt;.*)&amp;ven\\S(?&lt;Vendor&gt;.*)&amp;prod\\S(?&lt;Product&gt;\\S*)&amp;rev\\S"" \xa0\xa0| stats \xa0count by Date, host, Vendor, Product, DeviceType \xa0\xa0| fields \xa0- count \xa0\xa0| sort \xa0- Date'",2014-11-25T12:50:28+00:00,2015-04-09T01:08:04+00:00
Removal of USB Storage Device -,SplunkNinja,WinRegistry,This query will detect if any USB storage device was removed from a Windows machine (confirmed on Windows 7). ,"'sourcetype=WinRegistry key_path=""HKLM\\\\system\\\\controlset*\\\\enum\\\\usbstor\\\\*"" \xa0process_image=""c:\\\\Windows\\\\System32\\\\svchost.exe"" \xa0registry_type=DeleteKey | eval Date=strftime(_time, ""%Y/%m/%d %H:%M:%S"") | rex ""key_path.*usbstor\\S(?&lt;DeviceType&gt;.*)&amp;ven\\S(?&lt;Vendor&gt;.*)&amp;prod\\S(?&lt;Product&gt;\\S*)&amp;rev\\S"" | stats count by Date, host, Vendor, Product, DeviceType \xa0\xa0| fields \xa0- count \xa0\xa0| sort \xa0- Date'",2015-04-09T01:09:57+00:00,
List of Users in a Linux Environment -,SplunkNinja,linux_secure,The following splunk query will ouput a list of user accounts appearing in linux_secure audit logs: ,"'sourcetype=linux_secure | rex ""\\suser^\'(?&lt;User&gt;\\S+\\w+)"" | stats count by User'",2015-04-14T18:31:01+00:00,
Count of Unique Users in a Linux Environment -,SplunkNinja,linux_secure,This splunk query will return the total number of unique users in a given time range. &nbsp; ,"'sourcetype=linux_secure | rex ""\\suser^\'(?&lt;User&gt;\\S+\\w+)"" | stats dc(User)'",2015-04-17T20:59:01+00:00,
Top 10 most active Users in Linux -,SplunkNinja,linux_secure,The following splunk query example will return the top 10 most active users in a given time range &nbsp; ,"'sourcetype=linux_secure | rex ""\\suser^\'(?&lt;User&gt;\\S+\\w+)"" | top limit=10 User'",2015-04-17T21:00:14+00:00,
List of Hosts in a Linux Environment -,SplunkNinja,linux_secure,The following splunk query example will return a list of hosts by hostname in a given time range. *NOTE* if the host field is being autoextracted (for instance if you are using a universal forwarder) you will not need the regex command and can call upon the auto extracted fieldname of &#8220;host&#8221; ,"'sourcetype=linux_secure |rex "".*:\\d{2}\\s(?&lt;hostname&gt;\\S+)"" | stats count by hostname'",2015-04-17T21:02:37+00:00,
Count of Unique Hosts in Linux -,SplunkNinja,linux_secure,The following splunk query example will return a unique count of hosts in a given time range *NOTE* if the host field is being autoextracted (for instance if you are using a universal forwarder) you will not need the regex command and can call upon the auto extracted fieldname of &#8220;host&#8221; ,"'sourcetype=linux_secure |rex "".*:\\d{2}\\s(?&lt;hostname&gt;\\S+)"" | stats dc(hostname)'",2015-04-17T21:04:01+00:00,
Top 10 Most Active Hosts in a Linux Environment -,SplunkNinja,linux_secure,,"'sourcetype=linux_secure |rex "".*:\\d{2}\\s(?&lt;hostname&gt;\\S+)"" | top limit=10 hostname'",2015-04-17T21:05:38+00:00,
Number of Hosts the Root Account was Detected on -,SplunkNinja,linux_secure,,"'sourcetype=linux_secure |rex "".*:\\d{2}\\s(?&lt;hostname&gt;\\S+)"" | rex ""\\suser^\'(?&lt;User&gt;\\S+\\w+)"" | search User=""root"" | stats dc(hostname)'",2015-04-17T21:07:24+00:00,
Escalation of Privileges via SU in Linux -,SplunkNinja,linux_secure,,"'sourcetype=linux_secure source=""/var/log/*"" ""su: ("" \xa0| eval Date=strftime(_time, ""%Y/%m/%d"") | rex "".*:\\d{2}\\s(?&lt;hostname&gt;\\S+)"" | rex ""su:\\s\\Sto\\sroot\\S\\s(?&lt;SU&gt;\\S+)"" \xa0| stats \xa0count by Date, hostname, SU \xa0| rename \xa0count as ""Occurrences"" \xa0| rename \xa0SU as ""Account with Escalated Privileges"" | sort - Date'",2015-04-17T21:09:40+00:00,
Failed Windows Remote Desktop Connection Attempt -,SplunkNinja,WinEventLog:Security,"The following splunk query example will return results on any Windows remote desktop connection attempts. This could be a result of a bad password, invalid user name, or any number of other reasons. Ensure the Splunk App for Windows is installed grab it here:\xa0https://apps.splunk.com/app/742/ &nbsp; Windows Server 2008 and Newer: ","'source=WinEventLog:Security sourcetype=WinEventLog:security Logon_Type=10 EventCode=4625 | eval Date=strftime(_time, ""%Y/%m/%d"") | rex ""Failed:\\s+.*\\s+Account\\sName:\\s+(?&lt;TargetAccount&gt;\\S+)\\s"" | stats count by Date, TargetAccount, Failure_Reason, host | sort - Date', u'source=WinEventLog:Security sourcetype=WinEventLog:security Logon_Type=10 (EventCode=529 OR EventCode=530 OR EventCode=531 OR EventCode=532 OR EventCode=533 OR EventCode=534 OR EventCode=535 OR EventCode=536 OR EventCode=537 OR EventCode=539) | eval Date=strftime(_time, ""%Y/%m/%d"") | sort - Date'",2015-04-20T23:09:03+00:00,2015-04-20T23:10:06+00:00
Accounts Deleted within 24 Hours of Creation -,SplunkNinja,WinEventLog:Security,,"'sourcetype=WinEventLog:Security (EventCode=4726 OR EventCode=4720) |eval Date=strftime(_time, ""%Y/%m/%d"") |rex ""Subject:\\s+\\w+\\s\\S+\\s+\\S+\\s+\\w+\\s\\w+:\\s+(?&lt;SourceAccount&gt;\\S+)"" | rex ""Target\\s\\w+:\\s+\\w+\\s\\w+:\\s+\\S+\\s+\\w+\\s\\w+:\\s+(?&lt;DeletedAccount&gt;\\S+)"" | rex ""New\\s\\w+:\\s+\\w+\\s\\w+:\\s+\\S+\\s+\\w+\\s\\w+:\\s+(?&lt;NewAccount&gt;\\S+)"" | eval SuspectAccount=coalesce(DeletedAccount,NewAccount) | transaction SuspectAccount startswith=""EventCode=4720"" endswith=""EventCode=4726"" |eval duration=round(((duration/60)/60)/24, 2) | eval Age=case(duration&lt;=1, ""Critical"", duration&gt;1 AND duration&lt;=7, ""Warning"", duration&gt;7, ""Normal"")| table Date, index, host, SourceAccount, SuspectAccount, duration, Age | rename duration as ""Days Account was Active"" | sort + ""Days Account was Active""', u'sourcetype=WinEventLog:Security (EventCode=630 OR EventCode=624) |eval Date=strftime(_time, ""%Y/%m/%d"") | transaction Target_Account_Name startswith=""EventCode=624"" endswith=""EventCode=630"" |eval duration=round(((duration/60)/60)/24, 2) | eval Age=case(duration&lt;=1, ""Critical"", duration&gt;1 AND duration&lt;=7, ""Warning"", duration&gt;7, ""Normal"")| table Date, index, host, Caller_User_Name, Target_Account_Name, duration, Age | rename duration as ""Days Account was Active"" | sort - Date'",2015-04-20T23:05:45+00:00,2015-04-20T23:10:21+00:00
Linux Cron Job Information -,SplunkNinja,Cron,This splunk query example uses regex (regular expressions) to extract information on Linux cron jobs. *Note* this query has not been extensively tested ,"'sourcetype=""cron"" | eval Date=strftime(_time, ""%Y/%m/%d"") | rex "".*:\\d{2}\\s(?&lt;hostname&gt;\\S+)"" | rex "":\\sfinished(?&lt;Info&gt;.*)"" \xa0| stats count by Date, hostname, Info'",2015-04-20T23:13:36+00:00,
Windows Failed Logons with Average Overlay -,ItsJohnLocke,WinEventLog:Security,This Splunk search will show any failed login attempt and graphically overlay an average value. &nbsp; ,"'sourcetype=""WinEventLog:Security"" (Logon_Type=2 OR Logon_Type=7 OR Logon_Type=10) (EventCode=4625 OR EventCode=529 OR EventCode=530 OR EventCode=531 OR EventCode=532 OR EventCode=533 OR EventCode=534 OR EventCode=535 OR EventCode=536 OR EventCode=537 OR EventCode=539) | timechart count(EventCode) as count | eventstats avg(count) as Average | eval average=round(average,0) | rename count as ""Failed Logons""'",2015-04-24T19:32:14+00:00,
Successful Windows Logons with Average Overlay -,ItsJohnLocke,WinEventLog:Security,The following Splunk query will display successful windows logins and overlay an average on visualizations. ,"'sourcetype=""WinEventLog:Security"" (Logon_Type=2 OR Logon_Type=7 OR Logon_Type=10) (EventCode=528 OR EventCode=540 OR EventCode=4624) | timechart count(EventCode) as count | eventstats avg(count) as Average | eval average=round(average,0) | rename count as ""Successful Logons""'",2015-04-24T19:32:51+00:00,
Clearing of Windows Audit Logs -,ItsJohnLocke,WinEventLog:Security,"This Splunk search will show anytime the windows audit logs (event viewer logs) have been cleared or deleted. Ensure the Splunk App for Windows is installed, you can grab it here:\xa0https://apps.splunk.com/app/742/ ","'source=WinEventLog:security (EventCode=1102 OR EventCode=517) | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Client_User_Name, host, index, Date | sort - Date | rename Client_User_Name as ""Account Name""'",2015-04-24T19:32:53+00:00,
Unintended Windows Shutdowns -,ItsJohnLocke,WinEventLog:System,"This splunk query will show any unintended Windows system Shutdowns. Ensure the Splunk App for Windows is installed, you can grab it here:\xa0https://apps.splunk.com/app/742/ ","'sourcetype=""WinEventLog:system"" EventCode=6008 | eval Date=strftime(_time, ""%Y/%m/%d"") | table \xa0Date host, index, Message \xa0| sort \xa0- Date'",2015-04-24T19:32:54+00:00,
List of Legitimate Account Names in Windows -,ItsJohnLocke,WinEventLog:Security,,"'source=""WinEventLog:security"" (Logon_Type=2 OR Logon_Type=7 OR Logon_Type=10) (EventCode=528 OR EventCode=540 OR EventCode=4624) | rex ""New\\sLogon:\\s+.*\\s+Account\\sName:\\s+(?&lt;UserName&gt;\\S+)"" | eval Account=coalesce(User_Name,UserName) | stats count by Account | sort - count'",2015-04-24T19:32:56+00:00,
Comparing Stats Time Over Time -,kfeagans,_internal,,"'index=_internal earliest=-48h latest=-24h | bin _time span=10m | stats count by _time | eval window=""yesterday"" | append search index=_internal earliest=-24h | bin _time span=10m | stats count by _time | eval window=""today"" | eval _time=(_time-(60*60*24)) | timechart span=10m sum(count) by window'",2015-04-28T19:46:48+00:00,2015-04-28T19:47:56+00:00
Clean or Delete Data in a given Source -,SplunkNinja,Uncategorized,The following Splunk query will wipe or clear a data source. Ensure you specify an index else it will wipe the given source for all indexes. ,'source=path\\to\\sourcename | delete',2015-05-01T09:46:02+00:00,
Repeated Unsuccessful Logon Attempts in Linux -,SplunkNinja,linux_secure,"The following Splunk search query will return results for failed login attempts in a Linux environment for a specified time range. The regular expressions are defined within the search string, however if you already extracted the necessary fields you can ignore the regex section. &nbsp; ","'sourcetype=linux_secure | eval Date=strftime(_time, ""%Y/%m/%d"") | rex "".*:\\d{2}\\s(?&lt;hostname&gt;\\S+)"" | rex ""gdm\\S+\\sauthentication\\s(?&lt;status&gt;\\w+)"" | rex ""\\suser^\'(?&lt;User&gt;\\S+\\w+)"" | search status=failure| stats count as fails by Date, User, hostname | eval ""Alert Level""=case(fails&gt;=50, ""Critical"", fails&lt;50 AND fails&gt;=20, ""Warning"", fails&lt;20, ""Normal"") | sort - fails| rename fails as ""Failed Logon Attempts"" | rename User as ""Account in Question""'",2015-05-01T09:50:01+00:00,
Splunk License Gauge -,SplunkNinja,Uncategorized,This Splunk search query will show current license usage ,"'| rest splunk_server=local /services/licenser/pools | rename title AS Pool | search rest splunk_server=local /services/licenser/groups | search is_active=1 | eval stack_id=stack_ids | fields stack_id | join type=outer stack_id rest splunk_server=local /services/licenser/stacks | eval stack_id=title | eval stack_quota=quota | fields stack_id stack_quota | stats sum(used_bytes) as used max(stack_quota) as total | eval usedGB=round(used/1024/1024/1024,3) | eval totalGB=round(total/1024/1024/1024,3) | eval gauge_base=0 | eval gauge_danger=totalGB*0.8 | eval gauge_top=totalGB+0.001 | gauge usedGB gauge_base gauge_danger totalGB gauge_top'",2015-05-02T17:08:07+00:00,
Splunk License Usage Over the Last 30 Days -,SplunkNinja,Uncategorized,The following Splunk Search will show\xa0license usage\xa0over the past 30 days: ,"'index=_internal source=*license_usage.log type=""RolloverSummary"" earliest=-30d@d \xa0 | eval _time=_time - 43200 | bin _time span=1d | stats latest(b) AS b by slave, pool, _time | timechart span=1d sum(b) AS ""volume"" fixedrange=false | join type=outer _time search index=_internal source=*license_usage.log type=""RolloverSummary"" earliest=-30d@d | eval _time=_time - 43200 | bin _time span=1d | stats latest(stacksz) AS ""stack size"" by _time | fields - _timediff \xa0| foreach * eval &lt;&lt;FIELD&gt;&gt;=round(\'&lt;&lt;FIELD&gt;&gt;\'/1024/1024/1024, 3)'",2015-05-02T17:24:04+00:00,
Rename _time field in a TimeChart -,SplunkNinja,Uncategorized,When running a timechart splunk search query you may wish to rename the field _time. In order to do this you must first save the search to a dashboard or report. Once saved edit the source and add the following in the panel: ,"'&lt;option name=""charting.axisTitleX.text""&gt;Date&lt;/option&gt;'",2015-05-12T16:54:45+00:00,
Top 5 Visiting Countries in IIS -,SplunkNinja,IIS,The following Splunk query will list the top 5 visiting countries using the built in &#8220;iplocation&#8221; feature in Splunk: ,"'sourcetype=""iis"" | iplocation c_ip |top limit=5 Country | eval percent = round(percent,2) . "" %"" | rename count as Views | rename percent as Percent'",2015-05-16T02:41:03+00:00,
Visits by Days of the Week in IIS -,SplunkNinja,IIS,The following Splunk query will show the number of web visits for each weekday: ,"'sourcetype=""iis"" | eval uppercase=upper(substr(date_wday,1,1)).substr(date_wday,2)|dedup JSESSIONID| top limit=7 uppercase | eval sort_field=case(uppercase==""Sunday"",1, uppercase==""Monday"",2, uppercase==""Tuesday"",3, uppercase==""Wednesday"",4, uppercase==""Thursday"",5, uppercase==""Friday"",6, uppercase==""Saturday"",7) | sort + sort_field | fields - sort_field |rename count as Visits | rename uppercase as ""Day of the Week""'",2015-05-16T02:46:43+00:00,
Most Active Day and Least Active Day for IIS Web Traffic -,SplunkNinja,IIS,The following Splunk query will return the most active and the least active days for web traffic in an IIS environment: ,"'sourcetype=""iis"" | bucket span=1d _time |top limit=1 _time | eval Date=strftime(_time, ""%m/%d/%Y"") | eval Metric=""Most Active Date"" | append search sourcetype=""iis"" | bucket span=1d _time |rare limit=1 _time | eval Date=strftime(_time, ""%m/%d/%Y"") | eval Metric=""Least Active Date"" | fields - _time, count, percent | fields Metric, Date'",2015-05-16T02:51:28+00:00,
Total Hits on Least Active Day in IIS -,SplunkNinja,IIS,The following Splunk Query will return the total number of hits to a web site on the least active day of a given time range: ,"'sourcetype=""iis"" | \xa0rare limit=1 date_mday | rename count as Value | fieldformat Value=tostring(Value,""commas"")| eval Metric=""Number of hits on least active date"" | fields - date_mday, count, percent | fields Metric, Value'",2015-05-16T02:54:29+00:00,
Total Hits on Most Active Day in IIS -,SplunkNinja,IIS,The following Splunk query will return the total number of hits on the most active day in a given time range within an IIS environment: ,"'sourcetype=""iis"" | \xa0top limit=1 date_mday | rename count as Value| fieldformat Value=tostring(Value,""commas"") | eval Metric=""Number of hits on Most active date"" | fields - date_mday, count, percent | fields Metric, Value'",2015-05-16T02:55:46+00:00,
Visits by Hour of the Day in IIS -,SplunkNinja,IIS,The following Splunk query will list the total visits for each hour in a given time range. ,"'sourcetype=""iis"" | top limit=24 date_hour | sort +date_hour | rename count as Visits | rename date_hour as ""Hour of the Day""'",2015-05-16T02:58:24+00:00,
Weekend Web Traffic Summary in IIS -,SplunkNinja,IIS,The following Splunk query will return a summary of weekend activity for a given IIS hosted website. ,"'sourcetype=""iis"" (date_wday=saturday OR date_wday=sunday) | stats count(JSESSIONID) as Value | eval Metric=""Total Hits on Weekends"" | append search sourcetype=""iis"" (date_wday=saturday OR date_wday=sunday)| stats dc(JSESSIONID) as Value | eval Metric=""Total Visits on Weekends"" | append search sourcetype=""iis"" (date_wday=saturday OR date_wday=sunday) JSESSIONID=* | stats dc(JSESSIONID) as count by date_wday | stats avg(count) as Value by date_wday | eval Value=round(Value) | top limit=1 Value | eval Metric = ""Average Number of Visits per day on Weekends""| append search sourcetype=""iis"" (date_wday=saturday OR date_wday=sunday) JSESSIONID=* | stats count(JSESSIONID) as count by date_wday | stats avg(count) as Value by date_wday | eval Value=round(Value) | top limit=1 Value | eval Metric = ""Average Number of Hits per day on Weekends"" | fieldformat Value=tostring(Value,""commas"") | fields - count, percent | fields Metric, Value'",2015-05-16T03:04:12+00:00,
Weekday Web Traffic Summary in IIS -,SplunkNinja,IIS,The following Splunk query will show a summary of all weekday activity for a given website in IIS. ,"'sourcetype=""iis"" (NOT date_wday=saturday) (NOT date_wday=sunday) | stats count(JSESSIONID) as Value | eval Metric=""Total Hits on Weekdays"" | append search sourcetype=""iis"" (NOT date_wday=saturday) (NOT date_wday=sunday) | stats dc(JSESSIONID) as Value | eval Metric=""Total Visits on Weekdays"" | append search sourcetype=""iis"" (NOT date_wday=saturday) (NOT date_wday=sunday) JSESSIONID=* | stats dc(JSESSIONID) as count by date_wday | stats avg(count) as Value by date_wday | eval Value=round(Value) | top limit=1 Value | eval Metric = ""Average Number of Visits per day on Weekdays""| append search sourcetype=""iis"" (NOT date_wday=saturday) (NOT date_wday=sunday) JSESSIONID=* | stats count(JSESSIONID) as count by date_wday | stats avg(count) as Value by date_wday | eval Value=round(Value) | top limit=1 Value | eval Metric = ""Average Number of Hits per day on Weekdays"" | fieldformat Value=tostring(Value,""commas"") | fields - count, percent |fields Metric, Value'",2015-05-16T03:04:33+00:00,
List of Indexes -,ItsJohnLocke,Uncategorized,This simple Splunk query will return results for indexes that the current user (typically you) have access to: *NOTE* depending on settings this may or may not return internal indexes. ,'host=* | dedup index |table index',2015-06-08T16:06:21+00:00,
Total Unique Browsers detected in IIS logs -,SplunkNinja,IIS,The following Splunk search query will show a count of unique browsers (calculation to include version) that hit a given website within IIS logs: ,'sourcetype=iis | stats dc(cs_User_Agent)',2015-06-10T17:07:59+00:00,
User Agent - Browser Details &amp; Information for IIS -,SplunkNinja,IIS,,"'sourcetype=iis |dedup JSESSIONID| eval http_user_agent=urldecode(cs_User_Agent) | lookup browscap_lookup_express http_user_agent OUTPUT ua_parent ua_crawler ua_ismobiledevice| stats count by ua_parent ua_crawler ua_ismobiledevice | rename ua_parent as ""Browser Name and Version"" ua_crawler as Crawler ua_ismobiledevice as ""Mobile Device""'",2015-06-18T10:17:03+00:00,
User Agent \u2013 Operating System Info for web traffic -,SplunkNinja,IIS,The following Splunk Query will return a list of operating systems used within IIS logs traffic. It essentially uses a lookup to check the user agent against a known list. *NOTE* The app TA-browscap_express \u2013\xa0HTTP User Agent lookup with browscap must be installed ,"'sourcetype=iis |dedup JSESSIONID | eval http_user_agent=urldecode(cs_User_Agent) | lookup browscap_lookup_express http_user_agent OUTPUT ua_platform_description | stats count by ua_platform_description | rename ua_platform_description as ""Operating Systems Used"" | sort - count'",2015-06-22T15:17:11+00:00,
Get list of concurrent users on a specific server -,rupya1983,WinEventLog:Security,,"'sourcetype=""WinEventLog:Security"" EventCode=4624 (Logon_Type=10 OR Logon_Type=2) | bucket span=30m _time | eval Date=strftime(_time, ""%Y/%m/%d %H:%M:%S"") | rex ""New\\sLogon:\\s*Security\\sID:\\s+\\S*\\s+Account\\sName:\\s+(?&lt;ACCT&gt;\\S+)"" \xa0| stats count by ACCT, _time, host | where count&gt;1 | sort - count'",2015-06-30T16:41:17+00:00,
Event Logs | System Logs | Warnings and Errors -,kharris,WinEventLog:Application,This will hit all of the host and pull back the eventlogs and group them by Message. You can change the source to what ever windows eventlogs you need ,"'source=wineventlog:application', u'source=wineventlog:security', u'source=wineventlog:system', u'host=""*"" source=wineventlog:system NOT Type=Information | stats count by Message | sort -count | table count, Message'",2015-07-06T11:02:26+00:00,2015-07-06T11:05:01+00:00
List of hosts and sourcetypes not sending data in last 24 Hours -,alacer.cogitatus,_internal,,"'|noop |append  |metadata type=hosts | table * | append |metadata type=sourcetypes | table * | eval t = now() - lastTime | where t &gt; 86400 | eval name = coalesce(host,sourcetype)| table name t lastTime totalCount type |rename t as ""Seconds since Event"" | convert ctime(lastTime) timeformat=""%m/%d/%Y %H:%M:%S %z""'",2015-07-09T16:37:24+00:00,2015-07-09T16:40:42+00:00
Failed Versus Successful Logon Attempts -,SplunkNinja,WinEventLog:Security,This Splunk search query example will return results indicating failed vs successful login attempts in a Windows environment: ,"'source=""WinEventLog:security"" (Logon_Type=2 OR Logon_Type=7 OR Logon_Type=10) (EventCode=528 OR EventCode=540 OR EventCode=4624 OR EventCode=4625 OR EventCode=529 OR EventCode=530 OR EventCode=531 OR EventCode=532 OR EventCode=533 OR EventCode=534 OR EventCode=535 OR EventCode=536 OR EventCode=537 OR EventCode=539) | eval status=case(EventCode=528, ""Successful Logon"", EventCode=540, ""Successful Logon"", EventCode=4624, ""Successful Logon"", EventCode=4625, ""Failed Logon"", EventCode=529, ""Failed Logon"", EventCode=530, ""Failed Logon"", EventCode=531, ""Failed Logon"", EventCode=532, ""Failed Logon"", EventCode=533, ""Failed Logon"", EventCode=534, ""Failed Logon"", EventCode=535, ""Failed Logon"", EventCode=536, ""Failed Logon"", EventCode=537, ""Failed Logon"", EventCode=539, ""Failed Logon"") | stats count by status | sort - count'",2015-07-21T10:52:55+00:00,
List of Universal Forwarders with Version -,SplunkNinja,_internal,"The following Splunk query will return results of any host using a universal forwarder to transmit data back to a Splunk indexer. The query will return hostname, version, as well as architecture (64-bit vs 32-bit). &nbsp; ","'index=""_internal"" sourcetype=splunkd group=tcpin_connections NOT eventType=* | eval Hostname=if(isnull(hostname), sourceHost,hostname) | eval version=if(isnull(version),""pre 4.2"",version) | eval architecture=if(isnull(arch),""n/a"",arch) | stats count by Hostname version architecture | sort + version'",2015-07-25T02:15:39+00:00,
Last Time a Forwarder Checked In -,SplunkNinja,_internal,"The following Splunk Search Query will return results based on the last time a forwarder (universal forwarder, heavy forwarder, or otherwise) checked in. The query is a modified version of a query that was packaged with the Deployment Monitor app. ","'index=""_internal"" source=""*metrics.lo*"" group=tcpin_connections NOT eventType=* | eval sourceHost=if(isnull(hostname), sourceHost,hostname) | eval connectionType=case(fwdType==""uf"",""universal forwarder"", fwdType==""lwf"", ""lightweight forwarder"",fwdType==""full"", ""heavy forwarder"", connectionType==""cooked"" or connectionType==""cookedSSL"",""Splunk forwarder"", connectionType==""raw"" or connectionType==""rawSSL"",""legacy forwarder"")| eval build=if(isnull(build),""n/a"",build) | eval version=if(isnull(version),""pre 4.2"",version) | eval os=if(isnull(os),""n/a"",os)| eval arch=if(isnull(arch),""n/a"",arch) | eval lastReceived = case(kb&gt;0, _time) | eval seconds=30 | eval event_count= tcp_eps * seconds | bin _time span=10m | stats first(connectionType) as connectionType first(version) as version max(_time) as lastConnected max(lastReceived) as lastReceived sum(kb) as kbTotal \xa0sum(event_count) as events sum(seconds) as secs by sourceHost _time | stats first(connectionType) as connectionType first(version) as version max(lastConnected) as lastConnected max(lastReceived) as lastReceived by sourceHost | eval LastReceived=strftime(lastReceived, ""%Y/%m/%d %H:%M:%S"") | fields sourceHost, connectionType, LastReceived | sort + LastReceived'",2015-07-29T15:19:08+00:00,
License Usage by Sourcetypes -,SplunkNinja,_internal,The following Splunk query will return results for license usage by sourcetype: ,"'index=_internal source=""*license_usage.lo*"" type=Usage | stats sum(b) as bytes by st | eval Megabytes=bytes/1048576 |eval Megabytes=round(Megabytes,2) | fieldformat Megabytes=tostring(Megabytes,""commas"")| rename st as sourcetype | fields - bytes | sort - Megabytes'",2015-08-04T19:42:19+00:00,2015-08-12T14:34:01+00:00
Top 5 License Consuming Hosts -,SplunkNinja,_internal,The following Splunk search query will return the top five licensing consuming hosts: ,"'index=_internal source=*license_usage.log type=""Usage"" | stats sum(b) AS volume by h \xa0| eval \xa0GB=round(volume/1024/1024/1024,5) \xa0| table h GB \xa0| sort 5 - GB'",2015-08-24T19:02:53+00:00,
Percentage of Daily License Usage -,SplunkNinja,_internal,,"'| rest splunk_server=* /services/licenser/pools | rename title AS Pool | search rest splunk_server=* /services/licenser/groups | search is_active=1 | eval stack_id=stack_ids | fields stack_id | eval quota=if(isnull(effective_quota),quota,effective_quota) | eval ""% used""=round(used_bytes/quota*100,2) | fields ""% used""'",2015-08-24T19:09:25+00:00,
Internal Splunk User Modifications -,CattyWampus,audittrail,"This query will search the internal audit sourcetype of splunk and report on any user modification attempts, both success and fail. ","'index=_audit sourcetype=audittrail action=edit_user | eval Date=strftime(_time, ""%Y/%m/%d"") |where user!=object| stats count by user, info, object, Date | rename user as ""Authenticated User"" | rename info as ""Success Status"" | rename object as ""Modified Account"" | sort - count'",2014-11-10T12:22:40+00:00,2015-08-25T15:43:49+00:00
Low Disk Space Alert for Windows Servers -,Suren,Perfmon:Free Disk Space,,"'eventtype=hostmon_windows Type=Disk host=""*"" FileSystem=""*"" DriveType=""*"" | dedup host, Name | eval FreeSpacePct=round(FreeSpaceKB/TotalSpaceKB*100) | eval TotalSpaceGB=round(TotalSpaceKB/1024/1024) | eval FreeSpaceGB=round(FreeSpaceKB/1024/1024) | search FreeSpacePct&lt;10 TotalSpaceGB=""*"" | dedup host, Name, DriveType, TotalSpaceGB, FreeSpaceGB, FreeSpacePct | table host, Name, DriveType, TotalSpaceGB, FreeSpaceGB, FreeSpacePct | sort FreeSpacePct'",2015-08-27T15:50:19+00:00,
Apache access_logs status code reporting -,Suren,access_combined,,"'index=apache sourcetype=access_combined | chart count(eval(like(status,""2%""))) AS Success, count(eval(like(status,""4%"") OR like(status,""5%""))) AS Error by status', u'index=apache source=""/var/log/httpd/access_log"" | timechart count by status_description useother=f', u'index=apache sourcetype=access_combined| timechart count by status_type limit=10 usenull=f', u'index=apache sourcetype=access_combined status_type=""Server Error"" | table host status status_description method uri_path | rename host AS ""Server Name"" status AS ""Status Code"" status_description AS ""Description"" method AS ""Method"" uri_path AS ""URL Path""', u'index=apache source=""/var/log/httpd/access_log"" | dedup useragent | eval browser=useragent | replace *Firefox* with Firefox, *Chrome* with Chrome, *MSIE* with ""Internet Explorer"", *Version*Safari* with Safari, *Opera* with Opera, *rv:11.0* with ""Internet Explorer"" in browser| top limit=5 useother=t browser', u'index=apache source=""/var/log/httpd/access_log"" | dedup useragent| eval device=useragent |replace *Windows* with Windows, *Macintosh* with Apple, *Android* with Android, *iPhone* with iPhone, *iPad* with iPad in device | top limit=5 useother=t device'",2015-08-27T15:54:51+00:00,
Free Disk Space for each Drive Letter -,SplunkNinja,Perfmon:Free Disk Space,The following Splunk query will return results for all hosts reporting in Perfmon data on available disk space per assigned drive letter (NOTE you must make the change to include free diskspace per partition in your inputs.conf file) Query: ,"'sourcetype=""Perfmon:Free Disk Space"" counter=""Free Megabytes"" (instance!=""HarddiskVolume*"") (instance!=_Total) |eval FreeSpace=(Value/1024)| eval GB=tostring(FreeSpace,""commas"") | table host instance GB | sort + host instance | rename instance as ""Drive Letter"" GB as ""GigaBytes Free""'",2015-09-01T13:47:56+00:00,
Network Traffic Received in Megabytes over Time -,SplunkNinja,Perfmon:Network Interface,"The following splunk query will show a timechart of network traffic received over a period of time for any host specified (make sure you edit the query to specify a host, this one defaults to all). The query also converts the default value of Bytes to Megabytes. &nbsp; ","'sourcetype=""Perfmon:Network Interface"" (host=""*"") \xa0counter=""Bytes Received/sec""| eval MB=(Value/1024/1024)| timechart avg(MB) by host'",2015-09-03T19:00:02+00:00,
Network Traffic Sent in Megabytes over Time -,SplunkNinja,Perfmon:Network Interface,"The following splunk query will show a timechart of network traffic sent\xa0over a period of time for any host specified (make sure you edit the query to specify a host, this one defaults to all). The query also converts the default value of Bytes to Megabytes. &nbsp; ","'sourcetype=""Perfmon:Network Interface"" (host=""*"") \xa0counter=""Bytes Sent/sec"" | eval MB=(Value/1024/1024) | timechart \xa0avg(MB) by host'",2015-09-03T19:02:26+00:00,
Splunk Query Count by users -,databeastmaster,_internal,,"""index=_audit search=* NOT (search_id='scheduler* OR search_id='Summary*) user=admin | timechart span=1d count by user usenull=f""",2015-09-15T15:14:38+00:00,
Introspection - Memory used by SID (Search ID) -,chubbybunny,_internal,Chart memory used by each SID (search ID) using the Introspection logs ,"'index=""_introspection"" \xa0""data.process""=splunkd | timechart max(data.mem_used) by data.search_props.sid usenull=f useother=f'",2015-09-28T19:27:37+00:00,
"CPU Thresholds, Warnings, and Risk Scoring -",SplunkNinja,Perfmon:CPU Load,,"'sourcetype=""Perfmon:CPU Load"" |bucket _time span=30m | eval Load=round(Value,2) | stats avg(Load) as AVGL by host, _time | chart avg(AVGL) as AverageCPU by host | \xa0eval ""CPULoad""=case(AverageCPU&gt;90, ""Critical"", AverageCPU&gt;=70 AND AverageCPU&lt;=89, ""Warning"", AverageCPU&gt;=40 AND AverageCPU&lt;=69, ""Elevated"", AverageCPU&lt;40, ""Normal"") | stats count by CPULoad | sort - count CPULoad', u'&lt;option name=""charting.fieldColors""&gt;{""Critical"":0xD64541,""Warning"":0xF89406,""Elevated"":0x3498DB,""Normal"":0x2ECC71}&lt;/option&gt;'",2015-10-14T11:22:57+00:00,
Splunk User Search Activity -,CattyWampus,audittrail,"This will return a table of users who conducted searches, the total time it took for searches to complete, a count of said searches, and the last time a search was conducted. *NOTE* You will need to modify &#8220;splunk_server=local&#8221; specifically the &#8220;local&#8221; section to represent your Splunk server. ","'index=_audit splunk_server=local action=search (id=* OR search_id=*) | eval search_id = if(isnull(search_id), id, search_id) | replace \'*\' with * in search_id | rex ""search=\'search\\s(?&lt;search&gt;.*?)\',\\sautojoin""| search search_id!=scheduler_* | convert num(total_run_time) | eval user = if(user=""n/a"", null(), user) | stats min(_time) as _time first(user) as user max(total_run_time) as total_run_time first(search) as search by search_id | search search!=*_internal* search!=*_audit* | chart sum(total_run_time) as ""Total search time"" count as ""Search count"" max(_time) as ""Last use"" by user | fieldformat ""Last use"" = strftime(\'Last use\', ""%F %T.%Q"")'",2014-11-10T13:44:27+00:00,2015-10-22T16:15:32+00:00
Successful Linux Logons by Username -,ItsJohnLocke,linux_secure,"As stated in the title, this Splunk search query will return a list of all successful logons by user name on linux hosts. The regex is provided in the event the field is not extracted: ","'sourcetype=linux_secure |rex ""\\w{3}\\s\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}\\s\\S+\\s(?&lt;session&gt;gdm-\\w+)\\S:\\s""| search session=gdm-password | rex ""\\w{3}\\s\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}\\s(?&lt;hostname&gt;\\S+)\\s.+\\Sgdm-password:auth\\S:\\s(?&lt;authstatus&gt;\\w+\\s\\w+);\\s.+user=(?&lt;username&gt;\\S+)"" | search authstatus=""authentication success"" | stats count by username'",2015-11-19T14:38:11+00:00,2015-11-24T14:12:29+00:00
Timechart of Linux Logons -,ItsJohnLocke,linux_secure,The following splunk search will return a timechart of all successful logons for a given linux environment (regex provided): ,"'sourcetype=linux_secure |rex ""\\w{3}\\s\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}\\s\\S+\\s(?&lt;session&gt;gdm-\\w+)\\S:\\s""| search session=gdm-password | rex ""\\w{3}\\s\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}\\s(?&lt;hostname&gt;\\S+)\\s.+\\Sgdm-password:auth\\S:\\s(?&lt;authstatus&gt;\\w+\\s\\w+);\\s.+user=(?&lt;username&gt;\\S+)"" | search authstatus=""authentication success"" | timechart count(username)', u'sourcetype=linux_secure |rex ""\\w{3}\\s\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}\\s\\S+\\s(?&lt;session&gt;gdm-\\w+)\\S:\\s""| search session=gdm-password | rex ""\\w{3}\\s\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}\\s(?&lt;hostname&gt;\\S+)\\s.+\\Sgdm-password:auth\\S:\\s(?&lt;authstatus&gt;\\w+\\s\\w+);\\s.+user=(?&lt;username&gt;\\S+)"" | search authstatus=""authentication failure"" | timechart count(username)'",2015-11-24T20:20:48+00:00,
List of Failed Login Attempts in Linux -,ItsJohnLocke,linux_secure,"This Splunk search will show a count of all user accounts and a number of times they have attempted to logon. The REGEX is written into the query, remove it if you are already extracting those field names: &nbsp; ","'sourcetype=linux_secure |rex ""\\w{3}\\s\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}\\s\\S+\\s(?&lt;session&gt;gdm-\\w+)\\S:\\s""| search session=gdm-password | rex ""\\w{3}\\s\\d{1,2}\\s\\d{2}:\\d{2}:\\d{2}\\s(?&lt;hostname&gt;\\S+)\\s.+\\Sgdm-password:auth\\S:\\s(?&lt;authstatus&gt;\\w+\\s\\w+);\\s.+user=(?&lt;username&gt;\\S+)"" | search authstatus=""authentication failure"" | stats count by username | sort - count'",2015-11-18T12:15:54+00:00,2015-11-25T12:57:57+00:00
List Ports Forwarders are Using -,ItsJohnLocke,_internal,Use the following Splunk Search Query to list what ports your Universal Forwarders are using to communicate to the Indexer: ,"'index=""_internal"" source=""*metrics.lo*"" group=tcpin_connections NOT eventType=*\xa0 | dedup sourceHost |stats count by destPort'",2015-11-17T15:34:22+00:00,2015-11-25T12:59:27+00:00
Splunk Server Restart Duration -,ItsJohnLocke,_internal,"As titled, the following Splunk search query will show the restart duration (using the transaction command) of the Splunk service itself. &nbsp; ","'index=_audit (action=""splunkShuttingDown"" OR action=""splunkStarting"") | eval Date=strftime(_time, ""%Y/%m/%d"") | transaction splunk_server startswith=action=""splunkShuttingDown"" endswith=action=""splunkStarting"" | eval duration=round(duration/60, 2) |table Date splunk_server duration| rename duration as ""Splunk Restart Duration"" splunk_server as ""Splunk Server""'",2015-12-07T15:18:27+00:00,2015-12-07T15:18:43+00:00
Queries Executed in DBConnect -,ItsJohnLocke,audittrail,,"'index=_audit sourcetype=audittrail action=""db_connect_execute_query"" |rex ""user=(?&lt;user&gt;\\S+),\\s"" | rex mode=sed ""s/%20/ /g"" |rex mode=sed ""s/%5D//g"" |rex mode=sed ""s/%5B//g"" |rex mode=sed ""s/%3D/=/g"" |rex mode=sed ""s/%0A/ /g"" |rex mode=sed ""s/%2C/,/g"" |rex mode=sed ""s/%2F/\\//g"" |rex mode=sed ""s/%22/\\""/g"" | rex ""\\sREST:\\s\\/db_connect\\/query\\/.+SELECT(?&lt;DB_Query&gt;.+).\\w\\S\\w"" | table timestamp user DB_Query'",2015-12-08T14:40:50+00:00,
Permissions for splunk users -,manderso,_internal,Another view for which splunk user can do what in your splunk environment ,"'| rest /services/authentication/users | mvexpand roles | table realname, title, roles, email | join roles  rest /services/authorization/roles | rename title as roles | search srchIndexesAllowed=* | table roles srchIndexesAllowed'",2015-12-09T02:04:23+00:00,2015-12-17T03:31:30+00:00
Simple GeoIP Information for Web Traffic -,ItsJohnLocke,IIS,,"'sourcetype=""iis"" | iplocation c_ip | fillnull value=""Unknown"" Country | eval GeoLocation=case(Country=""United States"", ""Views from the United States"", Country=""Unknown"", ""Views from Unknown Origins"", Country!=""United States"" AND Country!=""Unknown"", ""International Views"") | top limit=3 GeoLocation | eval percent = round(percent,2) . "" %"" | rename GeoLocation as ""Visitor Nationality"" | rename percent as Percent | fields - count'",2015-10-29T19:17:43+00:00,2015-12-17T03:35:13+00:00
rangemap command with single value string -,Suren,_internal,,"'index=_internal sourcetype=splunkd OR sourcetype=splunkd_access | stats latest(sourcetype) as sourcetype | eval sourcetypeidx=case(sourcetype=""splunkd"",2,sourcetype=""splunkd_access"",1) | rangemap field=sourcetypeidx severe=0-1 low=2-4 default=low'",2016-01-13T19:26:25+00:00,
Search to show what apps are ready to be updated -,manderso,_internal,,"'| rest splunk_server=local /services/apps/local | search update.version=* | table title version update.version', u'&lt;i&gt;&lt;span style=""font-size: 10.0pt; color: #333333;""&gt;update.*&lt;/span&gt;&lt;/i&gt;', u'&lt;i&gt;&lt;span style=""font-size: 10.0pt; color: #333333;""&gt;splunk_server&lt;/span&gt;&lt;/i&gt;'",2016-01-13T19:24:52+00:00,2016-01-13T19:34:43+00:00
How to Check When Splunk is finished Indexing a log file -,Suren,_internal,How can I tell when Splunk is finished indexing a log file? (Credit for this one goes to learnsplunk.com author who originally posted it on his website) By watching \xa0data from splunk&#8217;s metrics log in real-time. ************************************************************ ,"'index=""_internal"" source=""*metrics.log"" group=""per_sourcetype_thruput"" series=""your_sourcetype_here"" | eval MB=kb/1024 | chart sum(MB)', u'index=""_internal"" source=""*metrics.log"" group=""per_sourcetype_thruput"" | eval MB=kb/1024 | chart sum(MB) avg(eps) over series'",2016-01-13T19:25:47+00:00,2016-01-14T11:46:54+00:00
User Activity in DBConnect -,SplunkNinja,_internal,The following Splunk query is for the DBConnect app. \xa0This will return all user activity using this particular app. I&#8217;ve provided the regex in the search. &nbsp; ,"'index=_audit sourcetype=audittrail action=""db_connect*"" |eval Date=strftime(_time, ""%Y/%d/%m"") |rex ""user=(?&lt;user&gt;\\S+),"" | stats count by Date, user, info, action'",2016-01-26T20:13:08+00:00,2016-01-26T20:15:54+00:00
Qualys Active OS Vuln Count -,CattyWampus,Qualys,The following Splunk Search (query) is for Qualys and will show vulnerability count for Windows Hosts. This query assumes that your index is defined as qualys. ,"'index=qualys HOSTVULN SEVERITY=3 OR 4 OR 5 TYPE=""CONFIRMED"" earliest=-30d@d | dedup HOST_ID, QID | search STATUS!=""FIXED"" |join QID search index=qualys QID_INFO PATCHABLE=1 | join HOST_ID search index=qualys HOSTSUMMARY: OS=""Windows*"" NOT ""Windows Server*"" | where cidrmatch(""10.128.0.0/9"", IP)  | stats count(QID) as #_Vulns by OS | sort -#_Vulns | addcoltotals #_Vulns'",2016-01-28T21:54:31+00:00,
Qualys Hosts not Scanned in 30 days+ -,CattyWampus,Qualys,The following Splunk Search (query) is for Qualys and will show hosts that have not been scanned in 30 days or more. This query assumes that your index is defined as qualys. ,"'index=qualys HOSTVULN earliest=-30d@d STATUS=""RE-OPENED""  | dedup HOST_ID, QID sortby +_time  | join HOST_ID search index=qualys HOSTSUMMARY OS=""Windows*"" NOT ""Windows Server*"" | where cidrmatch(""10.128.0.0/9"", IP)  | timechart span=1d count(QID) by SEVERITY'",2016-01-28T21:56:04+00:00,2016-02-01T12:37:27+00:00
Qualys 30 Day trending of Re-Opened Vulnerabilities -,CattyWampus,Qualys,The following Splunk Search (query) is for Qualys and will show a trending over 30 days for re-opened vulnerabilities. This query assumes that your index is defined as qualys. ,"'index=qualys HOSTVULN earliest=-30d@d STATUS=""RE-OPENED""  | dedup HOST_ID, QID sortby +_time  | join HOST_ID search index=qualys HOSTSUMMARY OS=""Windows*"" NOT ""Windows Server*"" | where cidrmatch(""10.128.0.0/9"", IP)  | timechart span=1d count(QID) by SEVERITY'",2016-01-28T21:55:43+00:00,2016-02-01T12:37:51+00:00
Qualys Top 10 Vulnerabilities by Severity -,CattyWampus,Qualys,The following Splunk Search (query) is for Qualys and will show the top 10 vulnerabilities by severity as well as a Count of Devices. ,"'sourcetype=qualys_vm_detection HOSTVULN SEVERITY=3 OR 4 OR 5 TYPE=""CONFIRMED"" earliest=-30d@d| dedup HOST_ID, QID | search STATUS!=""FIXED"" | join QID search sourcetype=qualys_knowledgebase PATCHABLE=1    | eval Published=strftime(strptime(PUBLISHED_DATETIME, ""%Y-%m-%d""), ""%m/%d/%Y"") | join HOST_ID search sourcetype=qualys_vm_detection HOSTSUMMARY OS=""Windows*"" NOT ""Windows Server*"" | where cidrmatch(""10.128.0.0/9"", IP)    |  stats count(HOST_ID) as #_Hosts by QID, Published, TITLE, SEVERITY | sort  -SEVERITY, 10 -#_Hosts'",2016-01-28T21:55:10+00:00,2016-02-01T12:38:01+00:00
List of Login Attempts to Splunk -,CattyWampus,audittrail,This will return a list of users who attempted to login to the splunk searchhead. It will list both successful attempts and failed attempts. ,"'index=_audit tag=authentication | stats count by user, info | sort - info'",2014-11-10T13:44:15+00:00,2016-02-01T13:11:28+00:00
Splunk Query to report on users logging on to the Splunk Web Console -,Suren,_internal,,'index=_audit tag=authentication info=succeeded |dedup user | table user timestamp',2015-08-27T15:50:41+00:00,2016-02-01T13:14:42+00:00
Traffic Volume by Forwarder -,SplunkNinja,_internal,"This Splunk search query will show you the top 10 &#8220;chattiest&#8221; forwarders on your network. I&#8217;ve used this query to determine why some forwarders were sending more data than others. The results are displayed in kilobits, you could use an eval to change it to the appropriate size for your network. ","'index=""_internal"" source=""*metrics.lo*"" group=tcpin_connections NOT eventType=* | eval sourceHost=if(isnull(hostname), sourceHost,hostname) | search sourceHost=*** | timechart per_second(kb) by sourceHost WHERE max in top5 useother=f'",2016-02-02T16:04:18+00:00,
Convert non timestamp time to Epoch -,SplunkNinja,Uncategorized,Scenario: You have a non timestamp field that you need to convert to epoch time to perform statistics on within splunk. Here&#8217;s how you do it: ,"'your search goes here |eval Epoch_Time=strptime(Field_Date, ""%Y-%m-%d %H:%M:%S"")'",2016-02-29T19:34:38+00:00,
Count of Attackers on Juniper Devices -,ItsJohnLocke,Juniper,The following is a Splunk search query that indicates potential \u201cattacks\u201d by source IP. \xa0Further investigation will be needed to determine accuracy of attacks. ,"'sourcetype = ""juniper:idp"" attack* | stats count by src_ip'",2016-03-19T17:43:35+00:00,
Available Memory in a Windows box -,SplunkNinja,Perfmon:Available Memory,"This query will return results based on amount of available memory. I output it to a gauge, you&#8217;ll want to modify your gauge to show up red as it approaches zero. ","'sourcetype=""Perfmon:Available Memory"" | bucket _time span=1m | eval gigabytes=(((Value/1024)/1024)/1024) | eval GB=round(gigabytes, 2) | gauge GB', u'source=\u201dPerfmon:Memory\u201d counter=\u201dAvailable Mbytes\u201d | bucket _time span=1m | eval gigabytes=(Value/1024) | eval GB=round(gigabytes, 2) | gauge GB'",2014-11-18T17:28:41+00:00,2016-04-01T21:31:08+00:00
Top Visited Pages in IIS Web Logs -,SplunkNinja,IIS,,"'sourcetype=""iis"" cs_Referer!=""-"" |dedup 20 JSESSIONID| top limit=21 cs_Referer |addtotals col=t labelfield=change_name label=Total |fields - Total | eval percent = round(percent,2) . "" %"" | rename count as Visits | rename percent as ""% Visits"" | rename change_name as ""Subtotal for rows 1-20"" | fields cs_Referer, ""Subtotal for rows 1-20"", Visits, ""% Visits"" |sort - Visits|rename cs_Referer to Page'",2016-04-08T19:01:05+00:00,
Timestamp vs Indextime of Events (Diagnostic Query) -,SplunkNinja,splunkd,"This query has in the past help me track down issues between forwarders and indexers, and even on occasion finding some time sync issues. Feel free to tweak, modify, and improve upon this query as I&#8217;m not 100% certain the math will work in your favor outside of highlighting (positive or negative) time differences! ","'index=* |eventstats max(_time) as MAXt max(_indextime) as MAXit by host|eval timediff=round(MAXt - MAXit)| convert ctime(MAXit) as idxtime ctime(MAXt) as Date |dedup timediff host | table idxtime Date timediff host | sort - timediff | rename Date as ""Timestamp of Event"" idxtime as ""Index Time Timestamp""'",2016-04-08T19:42:03+00:00,
Memory Usage and Information on Splunk Server -,ItsJohnLocke,REST,"This Splunk Search Query will perform a rest call to indicate current memory consumption on the Splunk server(s) itself/themselves: *NOTE* The following has been modified from the &#8220;Distributed Management Console&#8221; to be more generic for a copy, paste, and search example. ","'| rest splunk_server=* /services/server/status/resource-usage/hostwide \xa0| stats first(normalized_load_avg_1min) as load_average first(cpu_system_pct) as system, first(cpu_user_pct) as user first(mem) AS mem first(mem_used) AS mem_used by splunk_server | fields splunk_server mem mem_used | eval pctmemused=round((mem_used/mem)*100).""%"" | table splunk_server pctmemused | rename splunk_server as ""Splunk Server"" pctmemused as ""Percent of Memory Used""'",2016-05-04T10:18:15+00:00,
Count of Splunk Errors Per Host -,ItsJohnLocke,_internal,The following Splunk query will list the number of errors associated with each host over a given time range: ,"'index=_internal sourcetype=""splunkd"" log_level=""ERROR""\xa0 host!=splunk_server | stats count by host | sort - count'",2016-05-06T00:35:12+00:00,
Detailed list of Errors Per Host -,ItsJohnLocke,_internal,The following Splunk search will return a detailed list (by message) of errors associated with hosts running a universal forwarder: ,"'index=_internal sourcetype=""splunkd"" log_level=""ERROR"" | stats sparkline count dc(host) as uniqhosts last(message) as message last(_time) as last first(_time) as first by punct\xa0 | convert ctime(last) ctime(first) | table message count uniqhosts sparkline first last | sort -count | rename message as ""Error Output"" count as Count uniqhosts as ""Number of Hosts"" first as ""First Occurance"" last as ""Most Recent Occurance""'",2016-05-06T00:37:19+00:00,
List of Sourcetypes Sent by Forwarder -,SplunkNinja,_internal,The following Splunk search will show a list of sourcetypes (or perhaps sources I need to confirm) being sent by each Forwarder: ,"'index=""_internal"" |where host!=splunk_server | stats values(series) as Sourcetypes by host'",2016-05-06T00:44:11+00:00,
Count of Host added to Splunk by Month -,kishorebk,_internal,Can we get a Splunk Query that list of hosts added to Splunk in a month. \xa0Like Month 1 : 200 devices added Month 2: 400 devices added &nbsp; You would do this: ,'host=* | stats dc(host) as host by date_month',2016-05-13T13:38:57+00:00,2016-05-13T15:08:19+00:00
RFQ (Request For Query) - Port Scan -,rashid47010,RFQ - Request For Query,I am looking for the query,,2016-06-03T11:18:43+00:00,2016-06-03T11:18:53+00:00
Malware Detection -,ItsJohnLocke,Malware,I&#8217;m reposting this query I stumbled upon in a blog here. The description states that it can be used to detect malware reporting out to the web. Check out the article it&#8217;s a decent read. ,"'search.goes.here\xa0| convert mktime(_time) as epoch | sort 0 uri_host,client_ip,epoch | delta epoch as epoch_delta | search epoch_delta&gt;0 epoch_delta&lt;30 | chart count over epoch_delta by uri_host'",2016-06-15T19:58:09+00:00,2016-06-15T19:59:51+00:00
Worldmap with unique visitors last 24 hours -,m1ll3n1umf4lc0n,access_combined,,"'sourcetype=access_combined | iplocation sourceIP | stats dc(sourceIP) by Country | geom geo_countries featureIdField=""Country"" earliest=-24h'",2016-06-30T00:26:19+00:00,
Number of mails sent over time (Postfix) -,m1ll3n1umf4lc0n,postfix_syslog,,'sourcetype=postfix_syslog host=insertHostnameHere status=sent | timechart span=1d count',2016-06-30T00:27:17+00:00,2016-06-30T14:21:40+00:00
Nr. of unique visitors per hour timechart -,m1ll3n1umf4lc0n,access_combined,,'host=insertHostnameHere sourcetype=access_combined | timechart span=1h dc(sourceIP)',2016-06-30T00:26:44+00:00,2016-06-30T14:21:50+00:00
Convert Seconds to Hours Minutes Seconds HHMMSS -,SplunkNinja,eval,Take any field in splunk that outputs a value in seconds and change it to report in HH:MM:SS format: ,"'your.search.here\xa0| eval HHMMSS=tostring(Field_In_Seconds, ""duration"") | table HHMMSS'",2016-07-15T12:57:09+00:00,2016-07-15T12:58:42+00:00
Show uptime in Days -,manderso,Unix:Uptime,The following query shows uptime of all systems over a certain period of time (days_uptime). Replace my indexes w/ yours. ,"'\xa0index=os OR index=idx_appdev sourcetype=Unix:Uptime OR sourcetype=""WMI:Uptime"" |dedup host |eval DaysUp=round(SystemUpTime/86400,2) |eval Years=round(DaysUp/365,2) |eval Months=round(DaysUp/30,2)|search DaysUp &gt; $days_uptime$ | table host DaysUp Years Months SystemUpTime |sort - SystemUpTime |'",2016-07-20T02:26:27+00:00,
License Usage by Index per Day -,SplunkNinja,_internal,The following Splunk search query will output license usage for each index for each day for the week to date. It will also output an average for each index over the course of the given time period. &nbsp; ,"'index=_internal source=*license_usage.log type=""Usage"" splunk_server=* earliest=-1w@d | eval Date=strftime(_time, ""%Y/%m/%d"") | eventstats sum(b) as volume by idx, Date | eval MB=round(volume/1024/1024,5)| timechart first(MB) AS volume by idx '",2015-08-25T10:44:21+00:00,2016-08-12T17:41:19+00:00
Pass the Hash Detection -,srilankanmonkey,WinEventLog:Security,,"'index=""wineventlog"" ( EventCode=4624 Logon_Type=3 ) OR ( EventCode=4625 Logon_Type=3 ) Authentication_Package=""NTLM"" NOT Account_Domain=YOURDOMAIN\xa0NOT Account_Name=""ANONYMOUS LOGON""'",2016-08-12T17:58:23+00:00,
Linux Free Disk Space -,SplunkNinja,Linux Performance,The following Splunk query shows a percentage of free disk space over a period of time using timechart: ,"'index=os sourcetype=df PercentFreeSpace=* mount=""/"" | timechart latest(PercentFreeSpace) by host'",2016-09-10T15:35:59+00:00,2016-09-10T15:38:49+00:00
Linux Memory Usage -,SplunkNinja,Linux Performance,The following Splunk Search will show memory usage on a linux machine over a period of time using timechart: ,'index=os sourcetype=top pctMEM=*| transaction host _time | streamstats window=1 global=f sum(pctMEM) as MEM | timechart latest(MEM) by host',2016-09-10T15:34:54+00:00,2016-09-12T21:05:58+00:00
Linux CPU Usage -,SplunkNinja,Linux Performance,The following query will output CPU usage per host over a period of time using timechart: ,'index=os sourcetype=top pctCPU=* | transaction host _time | streamstats window=1 global=f sum(pctCPU) as CPU | timechart latest(CPU) by host',2016-09-10T15:33:48+00:00,2016-09-12T21:06:13+00:00
Top Header cpu &amp; memory status -,manderso,Linux Performance,"I didn&#8217;t like the CPU input from the Splunk TA Nix app, so I created this small ingest from top. The script\xa0takes a snapshot of the top command, and looks directly at the header: ","""top -b -n 1 | sed -n '1,5p'"", u'index=os sourcetype=top_header host=* |timechart span=1m values(load_1minavg) values(load_5minavg) values(load_15minavg) by host', u'index=os sourcetype=top_header host=* | eval percentUsed=mem_used/mem_total*100 | gauge percentUsed by host'",2016-09-22T18:39:58+00:00,
Pearson Coefficient of Two Fields -,yangzd,Fun Stuff &amp; Helpful Hints,The following SPL query calculates the Pearson coefficient of two fields named x and y. ,,2016-10-13T23:45:18+00:00,
All indexes not explicitly granted to a role -,ItsJohnLocke,REST,,,2016-10-19T11:35:56+00:00,2016-10-19T11:37:34+00:00
Every index explicitly granted to a role -,ItsJohnLocke,REST,"Self explanatory, maps roles to indexes. Useful if you have a lot of indexes! ",,2016-10-19T11:40:13+00:00,
Splunk Objects With Permissions Granted to Non-existent Roles -,ItsJohnLocke,REST,Useful search to show a bit of detail on roles and user permissions. ,,2016-10-19T11:41:12+00:00,
IIS Response Time -,kharris,IIS,,"'host=""*""\xa0 sourcetype=iis\xa0(insertIISurl) | eval time_taken = time_taken/1000\xa0 | stats\xa0 max(time_taken) AS ""Highest Response Time""', u'host=""*""\xa0 sourcetype=iis\xa0(insertIISurl) | eval time_taken = time_taken/1000\xa0 | stats\xa0 avg(time_taken) AS ""Average Response Time""', u'host=""*""\xa0 sourcetype=iis\xa0(insertIISurl) | eval time_taken = time_taken/1000\xa0 | stats\xa0 fastest(time_taken) AS ""Fastest Response Time""', u'host=""*""\xa0 sourcetype=iis\xa0""google.com"" | eval time_taken = time_taken/1000\xa0 | stats\xa0 max(time_taken) AS ""Highest Response Time""', u'', u''",2016-10-21T19:38:00+00:00,
REST Call for Splunk Server Role Status -,ItsJohnLocke,REST,This REST Splunk search returns the status of roles on each Splunk server in your environment. ,'| rest /services/server/introspection | table title splunk_server status updated',2016-10-25T10:14:42+00:00,
REST Call for a list of Lookup Files -,ItsJohnLocke,REST,Use this splunk search to get a list of all lookup files: ,'| rest /services/data/transforms/lookups | table eai:acl.app eai:appName filename title fields_list updated id',2016-10-26T11:47:30+00:00,
Average Splunk Web requests by hour -,ItsJohnLocke,_internal,This query is pretty awesome! It helped enlighten us to exactly when our splunk infrastructure is being hit with users ,,2016-10-19T11:39:02+00:00,2016-10-27T10:13:55+00:00
REST Call for Memory &amp; CPU usage on Splunk Servers -,ItsJohnLocke,REST,This Splunk search will show you use and available CPU and Memory statistics. Depending on your environment you may see multiple Splunk servers: ,"'| rest  /services/server/status/resource-usage/hostwide | eval cpu_count = if(isnull(cpu_count), ""N/A"", cpu_count) | eval cpu_usage = cpu_system_pct + cpu_user_pct | eval mem_used_pct = round(mem_used / mem * 100 , 2) | eval mem_used = round(mem_used, 0) | eval mem = round(mem, 0) |eval mem=tostring(mem, ""commas"") | eval mem_used=tostring(mem_used, ""commas"")| fields splunk_server, cpu_count, cpu_usage, mem, mem_used, mem_used_pct | sort - cpu_usage, -mem_used | rename splunk_server AS Instance, cpu_count AS ""CPU Cores"", cpu_usage AS ""CPU Usage (%)"", mem AS ""Physical Memory Capacity (MB)"", mem_used AS ""Physical Memory Usage (MB)"", mem_used_pct AS ""Physical Memory Usage (%)""'",2016-11-03T02:09:29+00:00,2016-11-03T02:10:01+00:00
Show all currently logged in users -,ItsJohnLocke,REST,,,2016-11-03T10:19:43+00:00,
List Inputs using REST -,ItsJohnLocke,REST,As the title says. Pretty nice Splunk Search if you&#8217;ve forgotten what inputs you have configured and need a central place to list them. ,"'| rest /services/data/inputs/all | convert ctime(starttime) AS ""Start Time""\xa0 | convert ctime(endtime) AS ""End Time"" | table index interval source sourcetype title updated starttime endtime ""Start Time"" ""End Time""'",2016-11-10T12:06:47+00:00,
List of Props.conf Extractions -,ItsJohnLocke,REST,Useful Splunk Query to show extractions from Props.conf: ,'| rest /services/data/props/extractions | table title type value attribute',2016-11-10T12:10:14+00:00,
List of Extractions in Transforms.conf -,ItsJohnLocke,REST,Useful Splunk Query to show REGEX extractions in Transforms.conf ,'| rest /services/data/transforms/extractions | table title eai:appName REGEX FORMAT updated',2016-11-10T12:11:16+00:00,
List of Alerts via REST -,ItsJohnLocke,REST,The following Splunk search (query) will show a list of alerts within Splunk via the | rest call: ,'| rest /services/alerts/fired_alerts splunk_server=local| table eai:acl.owner eai:acl.app id title triggered_alert_count',2016-11-29T11:36:18+00:00,
Monitor File Shares being Accessed in Windows -,john117,WinEventLog:Security,This splunk search will show file shares being accessed within windows environments. ,"'sourcetype=""WinEventLog:Security"" EventCode=5140 (Share_Name=""*\\\\C$"" OR Share_Name=""*D$"" OR Share_Name=""*E$"" OR Share_Name=""*F$"" OR Share_Name=""*U$"") NOT Source_Address=""::1"" | eval Destination_Sys1=trim(host,""1"") | eval Destination_Sys2=trim(host,""2"") | eval Dest_Sys1=lower(Destination_Sys1) | eval Dest_Sys2=lower(Destination_Sys2) | rename host AS Destination | rename Account_Domain AS Domain | where Account_Name!=Dest_Sys1 | where Account_Name!=Dest_Sys2 | stats count values(Domain) AS Domain, values(Source_Address) AS Source_IP, values(Destination) AS Destination, dc(Destination) AS Dest_Count, values(Share_Name) AS Share_Name, values(Share_Path) AS Share_Path by Account_Name'",2016-11-29T21:11:25+00:00,
Monitor for Service Changes in Windows -,john117,WinEventLog:System,The following splunk search looks for changes in services within Windows. &nbsp; ,"'sourcetype=""WinEventLog:System"" EventCode=7045 NOT (Service_Name=mgmt_service) | eval Message=split(Message,""."") | eval Short_Message=mvindex(Message,0) | table _time host Service_Name, Service_Type, Service_Start_Type, Service_Account, Short_Message'",2016-11-29T21:12:10+00:00,
Events Sent to Null Que - Internal Logs -,john117,_internal,This will show events that have been sent to the null que within the splunk internal logs. &nbsp; ,"'index=_internal component=metrics processor=nullqueue group=pipeline sourcetype=splunkd | table _time log_level name processor cpu_seconds executes, cumulative_hits'",2016-12-14T19:02:18+00:00,
Qualys - Number of Hosts Scanned -,SplunkNinja,Qualys,The following Splunk query will show the number of hosts scanned within the Qualys Sourcetype: ,"'eventtype=""qualys_vm_detection_event"" |eval Success= if(SEVERITY &gt;3,1,0)|stats count as total sum(Success) as success|eval Per_high=(success/total)*100 |'",2016-12-15T14:40:45+00:00,
Number of Vulnerabilities Detected - Qualys -,SplunkNinja,Qualys,The following Splunk query will show the number of vulnerabilities detected all severities and all types within the Qualys Sourcetype: ,"'eventtype=""qualys_vm_detection_event"" STATUS=""NEW""\xa0 | dedup QID |stats count by SEVERITY'",2016-12-15T14:42:30+00:00,
New Vulnerabilities Detected Since Last Scan - Qualys -,SplunkNinja,Qualys,As the title suggests this Splunk Search will dedup results so you can better see changes in Vulnerability detection scan to scan\xa0within the Qualys Sourcetype: ,"'eventtype=""qualys_vm_detection_event"" | dedup QID |stats count by SEVERITY'",2016-12-15T14:48:51+00:00,
Hosts Taking a Long Time to Scan - Qualys -,SplunkNinja,Qualys,The following Splunk query will show the hosts taking an abnormally lengthy time to scan (helps find that needle in a haystack) within the Qualys Sourcetype: ,"'sourcetype=""qualys:hostDetection"" eventtype=qualys_host_summary_event SCAN_DURATION&gt; 1800 | sort -SCAN_DURATION | table IP, DNS, OS, SCAN_DURATION'",2016-12-15T14:44:59+00:00,2016-12-15T14:49:07+00:00
High Severity Vulnerabilities - Qualys -,SplunkNinja,Qualys,The following Splunk query will show the percentage of high severity vulnerabilities within the Qualys Sourcetype: ,"'eventtype=""qualys_vm_detection_event"" |eval Success= if(SEVERITY &gt;3,1,0)|stats count as total sum(Success) as success|eval Per_high=(success/total)*100'",2016-12-15T14:51:54+00:00,
Top 25 Most Prevailing Vulnerabilities with Patches Available (Multiple OSs)- Qualys -,SplunkNinja,Qualys,The following Splunk Search Queries within the Qualys Sourcetype list the top 25 most prevailing vulnerabilities that have patches available. The queries are separated by Operating System or Device Type: Linux ,"'eventtype=qualys_vm_detection_event SEVERITY &gt; 3 STATUS=""ACTIVE"" | regex OS=""^((?!\\/).)*Linux((?!\\/).)*$"" | dedup HOST_ID QID | lookup qualys_kb_lookup QID OUTPUT TITLE SEVERITY VENDOR_REFERENCE | stats count by QID, TITLE, SEVERITY | sort 25 \u2013count', u'eventtype=qualys_vm_detection_event SEVERITY &gt; 3 STATUS=""ACTIVE"" | regex OS=""(F5 Networks Big-IP)|(^Cisco((?!\\/).)*$)|(Firewall)"" | dedup HOST_ID QID | lookup qualys_kb_lookup QID OUTPUT TITLE SEVERITY VENDOR_REFERENCE | stats count by QID, TITLE, SEVERITY | sort 25 \u2013count', u'eventtype=qualys_vm_detection_event SEVERITY &gt; 3 STATUS=""ACTIVE"" | regex OS=""^Windows (2000$|XP|7|8)((?!\\/).)*$"" | dedup HOST_ID QID | lookup qualys_kb_lookup QID OUTPUT TITLE SEVERITY VENDOR_REFERENCE | stats count by QID, TITLE, SEVERITY | sort 25 \u2013count', u'eventtype=qualys_vm_detection_event SEVERITY &gt; 3 STATUS=""ACTIVE"" | regex OS=""^Windows .*Server((?!\\/).)*$"" | dedup HOST_ID QID | lookup qualys_kb_lookup QID OUTPUT TITLE SEVERITY VENDOR_REFERENCE | stats count by QID, TITLE, SEVERITY | sort 25 \u2013count'",2016-12-15T14:58:31+00:00,2016-12-15T14:59:11+00:00
Remediation Tracking Trend - Qualys -,SplunkNinja,Qualys,The following Splunk query will help determine remediation tracking trends within the Qualys Sourcetype: ,"'eventtype=""qualys_vm_detection_event"" | stats count as eachCount |eval STATUS=""Total"" | table STATUS eachCount| append |search eventtype=""qualys_vm_detection_event""| stats count as eachCount by STATUS| eventstats sum(eachCount) as total | eval fixedPerc = ((eachCount/total)*100) | search STATUS=FIXED |table STATUS eachCount '",2016-12-15T14:54:03+00:00,2016-12-15T14:59:39+00:00
Top 25 Most Vulnerable Systems by OS - Qualys -,SplunkNinja,Qualys,The following Splunk Search Queries within the Qualys Sourcetype list the top 25 most vulnerable systems. The queries are separated by Operating System or Device Type: Linux ,"'eventtype=qualys_vm_detection_event SEVERITY &gt; 3 | regex OS=""^((?!\\/).)*Linux((?!\\/).)*$"" |dedup QID IP| stats count by IP | sort -count | head 25', u'eventtype=qualys_vm_detection_event SEVERITY &gt; 3 | regex OS=""(F5 Networks Big-IP)|(^Cisco((?!\\/).)*$)|(Firewall)"" |dedup QID IP| stats count by IP | sort -count | head 25', u'eventtype=qualys_vm_detection_event SEVERITY &gt; 3 | regex OS=""^Windows (2000$|XP|7|8)((?!\\/).)*$"" |dedup QID IP| stats count by IP | sort -count | head 25', u'eventtype=qualys_vm_detection_event SEVERITY &gt; 3 | regex OS=""^Windows .*Server((?!\\/).)*$"" |dedup QID IP| stats count by IP | sort -count | head 25'",2016-12-15T15:02:19+00:00,
Track Remediation Progress by OS - Qualys -,SplunkNinja,Qualys,The following Splunk Search Queries within the Qualys Sourcetype track the remediation progress for a variety of operating systems. The queries are separated by Operating System or Device Type: OS &amp; Device Agnostic ,"'eventtype=""qualys_vm_detection_event"" STATUS =""FIXED"" earliest=-30d@d | dedup HOST_ID, QID | stats count by QID', u'eventtype=qualys_vm_detection_event SEVERITY &gt; 3 | regex OS=""^((?!\\/).)*Linux((?!\\/).)*$"" |dedup QID IP| stats count by IP | sort -count | head 25', u'eventtype=qualys_vm_detection_event SEVERITY &gt; 3 | regex OS=""(F5 Networks Big-IP)|(^Cisco((?!\\/).)*$)|(Firewall)"" |dedup QID IP| stats count by IP | sort -count | head 25', u'eventtype=qualys_vm_detection_event SEVERITY &gt; 3 | regex OS=""^Windows (2000$|XP|7|8)((?!\\/).)*$"" |dedup QID IP| stats count by IP | sort -count | head 25', u'eventtype=qualys_vm_detection_event SEVERITY &gt; 3 | regex OS=""^Windows .*Server((?!\\/).)*$"" |dedup QID IP| stats count by IP | sort -count | head 25'",2016-12-15T15:05:31+00:00,
Potential Suspicious Activity in Windows -,john117,WinEventLog:Security,,"'sourcetype=""WinEventLog:Security"" EventCode=4688 NOT (Account_Name=*$) (arp.exe OR at.exe OR bcdedit.exe OR bcp.exe OR chcp.exe OR cmd.exe OR cscript.exe OR csvde OR dsquery.exe OR ipconfig.exe OR mimikatz.exe OR nbtstat.exe OR nc.exe OR netcat.exe OR netstat.exe OR nmap OR nslookup.exe OR netsh OR OSQL.exe OR ping.exe OR powershell.exe OR powercat.ps1 OR psexec.exe OR psexecsvc.exe OR psLoggedOn.exe OR procdump.exe OR qprocess.exe OR query.exe OR rar.exe OR reg.exe OR route.exe OR runas.exe OR rundll32 OR schtasks.exe OR sethc.exe OR sqlcmd.exe OR sc.exe OR ssh.exe OR sysprep.exe OR systeminfo.exe OR system32\\\\net.exe OR reg.exe OR tasklist.exe OR tracert.exe OR vssadmin.exe OR whoami.exe OR winrar.exe OR wscript.exe OR ""winrm.*"" OR ""winrs.*"" OR wmic.exe OR wsmprovhost.exe OR wusa.exe) | eval Message=split(Message,""."") | eval Short_Message=mvindex(Message,&lt;wbr /&gt;0) | table _time, host, Account_Name, Process_Name, Process_ID, Process_Command_Line, New_Process_Name, New_Process_ID, Creator_Process_ID, Short_Message'",2016-12-08T01:13:55+00:00,2016-12-15T15:32:21+00:00
Current Vulnerability Summary by Severity (tenable) -,Ronald (Access42),Tenable,"Having Tenable Security Center connected via the splunk plugin, this search gives an overview of all vulnerabilties, summarized by severity. ","'sourcetype=""tenable:sc:vuln"" severity.name=* | chart count over severity.name by ip'",2017-02-12T03:48:45+00:00,2017-02-12T03:50:39+00:00
Top exploitable vulnerabilities (tenable) -,Ronald (Access42),Tenable,To see the top of exploitable vulnarabilities from the Tenable Security Center: ,"'sourcetype=""tenable:sc:vuln"" exploitAvailable=""yes"" | chart count over pluginName by riskFactor'",2017-02-12T03:51:51+00:00,
Overall CVSS score (tenable) -,Ronald (Access42),Uncategorized,"Tenable uses the CVSS scoring method for detected vulnerabilities. To have an overall CVSS, use the following query: ","'sourcetype=""tenable:sc:vuln"" ip=* |stats mean(baseScore) as base | eval base = round(base,2)'",2017-02-12T03:51:18+00:00,2017-02-12T03:51:56+00:00
Top 10 most vulnerable systems (Tenable) -,Ronald (Access42),Tenable,Get an overview of the 10 most vulnerable systems in your network ,"'sourcetype=""tenable:sc:vuln"" baseScore &gt; 3 | dedup cve ip | stats count by ip, riskFactor | sort 10-count | lookup dnslookup clientip as ip | chart sum(count) by clienthost'",2017-02-13T20:39:34+00:00,
SSL Certificates expired -,Ronald (Access42),Tenable,The query below will give an overview of all hosts running expired certificates: ,"'sourcetype=""tenable:sc:vuln"" synopsis=""The remote server\'s SSL certificate has already expired."" | dedup ip | chart count by ip'",2017-02-13T20:39:49+00:00,
SSL certificates about to expire -,Ronald (Access42),Tenable,The query below will give an overview of all certificates about to expire (within 60 days) ,"'\xa0sourcetype=""tenable:sc:vuln"" synopsis=""The SSL certificate associated with the remote service will expire soon."" | dedup ip | lookup dnslookup clientip as ip | chart count by ip,clienthost'",2017-02-13T20:40:05+00:00,
Time Offset on Splunk Servers -,john117,REST,,"'| rest /services/server/info | eval updated_t=round(strptime(updated, ""%Y-%m-%dT%H:%M:%S%z""), 2) | eval delta=now()-updated_t | table serverName, updated, delta | convert ctime(updated_t)| rename updated as ""Local Time on Server on Request"" delta as ""Offset - Time in Seconds""'",2017-02-17T21:55:55+00:00,
Overview SMB Shares with unprivileged access (tenable) -,Ronald (Access42),Tenable,This search will give an overview of all SMB shares with unprivilged access. ,"'sourcetype=""tenable:sc:vuln"" pluginID=42411 | table ip dnsName pluginText | rename ""pluginText"" as ""Shares enabled"" | rename ""dnsName"" as ""DNS Name"" | rename ""ip"" as ""IP address""'",2017-02-24T15:34:50+00:00,
Detect ShellShock Attempts in Apache Logs -,mjeffery,apache,,"'sourcetype=""apache:access"" http_method=POST request=""*{ :;};*"" OR request=""*/bin/*""', u'| table _time, request, src_ip, dst_ip'",2017-03-01T02:51:59+00:00,
License Usage by Pool per hour for last 24 hours -,xoff00,_internal,Have a misbehaving License Pool that the admin swears he fixed this morning? ,"'index=_internal source=*license_usage.log* type=Usage earliest=-24h| bucket _time span=1h | stats sum(b) as bytes by _time, pool | eval GB = round(bytes/1024/1024/1024,5) | fields _time pool GB'",2017-03-16T19:37:31+00:00,
Use REST to gather Index Info -,ItsJohnLocke,REST,Here is some SPL to get useful information via REST on indexes within your Splunk environment: ,,2017-03-28T10:42:44+00:00,
User Info Dashboard - Using REST -,ItsJohnLocke,REST,I found this very useful user statistics/information splunk dashboard on www.function1.com/2016/06/rest-easy-with-the-splunk-rest-api. They have additional Splunk REST queries and examples worth checking out! ,,2017-03-30T09:56:03+00:00,
Overview of all medium to critical risks for Win20xx -,Ronald (Access42),Tenable,Get an overview of all medium to critical risks for Windows 2008 / 2012: Windows 2008: ,"'sourcetype=""tenable:sc:vuln"" cpe:/o:microsoft:windows_server_2008 \xa0| table ip, netbiosName, dnsName, severity.name, pluginName, solution, description | join ip type=inner max=0 search index=main sourcetype=""tenable:sc:vuln"" baseScore&gt;3 \xa0| table ip, netbiosName, dnsName, severity.name, pluginName, solution, description  | sort by severity.name | chart count by severity.name', u'sourcetype=""tenable:sc:vuln"" cpe:/o:microsoft:windows_server_2012 \xa0| table ip, netbiosName, dnsName, severity.name, pluginName, solution, description | join ip type=inner max=0 search index=main sourcetype=""tenable:sc:vuln"" baseScore&gt;3 \xa0| table ip, netbiosName, dnsName, severity.name, pluginName, solution, description  | sort by severity.name | chart count by severity.name'",2017-04-06T23:25:54+00:00,
Sysmon - Find Processes with Renamed Executables -,jwalzer,Uncategorized,,"'index=* sourcetype=""xmlwineventlog:microsoft-windows-sysmon/operational"" EventCode=1 | rex field=Image ""\\\\\\/(?&lt;filename&gt;^\\\\\\/*)$"" | eval filename=lower(filename)| stats dc(filename) as NumFilenames values(filename) as Filenames values(Image) as Images by Hashes | where NumFilenames&gt;1'",2017-07-02T02:49:13+00:00,
Sysmon - Outbound Connections by Process -,jwalzer,Uncategorized,,,2017-07-02T02:49:23+00:00,
Sysmon - cmd line for non -local connections -,jwalzer,Uncategorized,,,2017-07-02T02:49:32+00:00,
Extract DNS Queries from netscaler syslog -,Ronald (Access42),citrix:netscaler:syslog,To extract the DNS logging from netscaler:syslog you need the following regex: ^\\s+(?P&lt;date&gt;,"'\xa0index=network_netscaler sourcetype=""citrix:netscaler:syslog"" DNS | regex ""^\\s+(?P&lt;date&gt;^:+):(?P&lt;time&gt;^ +)(?:^:\\n*:){3}(?P&lt;source_ip&gt;^#+)(?:^/\\n*/){8}\\d+#(?P&lt;dns&gt;(?#)_a-zA-Z0-9.-+)(\\.\\/)"" | table time, date, source_ip, dns'",2017-07-06T01:54:45+00:00,
Find queues that are nearly full -,xoff00,_internal,Easily find Splunk Instances (both forwarders and full installs) that have queues that are over 80% full! ,"'index=_internal group=queue | eval percfull=((current_size_kb/max_size_kb)*100) | search percfull&gt;80 | dedup host, name | table _time host name current_size_kb max_size_kb'",2017-08-23T13:25:40+00:00,
Fishies! Fun Query and Easter Egg -,SplunkNinja,Fun Stuff &amp; Helpful Hints,Here is a fun query that you may have seen as an Easter egg in an app. I stumbled on this while cleaning up old saved searches. If you know the app comment below! &nbsp; FYI make sure you run this in real time otherwise you won&#8217;t see the fun part :) ,"'index=_* OR index=* | head 1 | eval fish=""&gt;&lt;((*&gt;"" | eval fishies=mvappend(fish,fish) | eval fishies=mvappend(fishies,fishies) | eval fishies=mvappend(fishies,fishies) | eval fishies=mvappend(fishies,fishies) | eval spawnify=fishies | mvexpand spawnify | eval fishies=mvjoin(fishies,"" "") | streamstats count as offset | eval offset=(offset*3) % 7 | addinfo | eval make_swim=round(info_max_time-info_search_time) | eval fishies=substr(fishies,(10*16)-(make_swim-offset+10),100+offset) | fields fishies | streamstats count | eval fishies=if(count==16,""FATAL ERROR: you have unleashed an army of fish."",fishies) | fields fishies | rename fishies as _raw | fields - _time | eval _raw=substr(_raw,0,100)'",2017-10-12T19:23:05+00:00,2017-10-12T19:27:32+00:00
Failed Attempts to Logon to Splunk Web -,SplunkNinja,_internal,The following Splunk Search Query will return all users who have failed to logon to the Splunk Web console. This query will also include an average (from eventstats). &nbsp; ,"'index=_audit action=""login attempt"" info=failed | timechart count(user) as Failed_Attempts| eventstats avg(Failed_Attempts) as Average'",2015-09-14T18:46:42+00:00,2017-10-13T15:28:17+00:00
Unable to get a search to work properly -,irishjd,RFQ - Request For Query,,"'| inputlookup flash_mi-000085-mw | lookup dnsLookup host as fqdn', u'| inputlookup flash_mi-000085-mw | lookup dnsLookup host as fqdn | search sourcetype=cisco:asa dest_ip=""xxx.xxx.0.0/16"" OR src_ip=""xxx.xxx.0.0/16"" AND ip', u'| inputlookup flash_mi-000085-mw | lookup dnsLookup host as fqdn | search sourcetype=cisco:asa dest_ip=""xxx.xxx.0.0/16"" OR src_ip=""xxx.xxx.0.0/16"" AND ip | where fqdn!="""" | table fqdn ip dest_ip src_ip'",2017-11-14T02:39:30+00:00,
Find passwords in User_Name field -,thall,eval,,"'\xa0source=WinEventLog:Security TaskCategory=Logon Keywords=""Audit Failure"" | eval password=if(match(User_Name, ""^(?=.*a-z)(?=.*A-Z)(?=.*0-9)(?=.*\\W)(?=.{10,})""), ""Yes"", ""No"") | stats count by password User_Name | search password=Yes'",2017-12-02T21:10:45+00:00,
Remove Z or T string from your Timestamp -,sahr.lebbie,eval,,,2018-01-03T02:25:33+00:00,
IIS: Indicators of XSS and SQLi attacks -,Ronald (Access42),IIS,"The following query show IoC for XSS and SQLi. The complete query is wrapped up since this site is not accepting it.\xa0The query should also include &#8220;OR javascript&#8221;, followed by &#8220;:alert&#8221;. ","'index=* sourcetype=""ms:iis:default"" NOT (""cookie.js"" OR ""script.js"" OR ""cookie-min.js"" OR ""RESET-COOKIE"" OR ""form.user-info-from-cookie"") AND (\u201c&amp;#\u201d OR ""script&gt;"" OR ""script%3E"" OR ""`"" OR ""cookie"" OR alert\\( OR ""&lt;/"" OR ""@@"" OR ""%40%40"" OR ""&lt;scr"" OR ""%3Cscr"" OR ""&lt;"" OR ""%3C%2F"" OR ""..%2F"" OR "".."" OR ""%2E%2E"") uri_query!=""-"" uri_query!=""utm_*""| table _time, clientip, status, uri_query | sort by _time desc'",2018-02-07T02:56:30+00:00,
IIS: 401 and 403 errors -,Ronald (Access42),IIS,"Get an overview of 401 and 403 errors, an increase might be an IoC. ","'&lt;code&gt;index=* sourcetype=""ms:iis:default"" sc_status=401 OR sc_status=403 |table _time, sc_status, sc_substatus, uri_path | timechart count by sc_status&lt;/code&gt;'",2018-02-07T02:56:36+00:00,
IIS: 404 errors -,Ronald (Access42),IIS,"Get an overview of all 404 errors, an increase might be an IoC ","'index=web_p sourcetype=""ms:iis:default"" status=404 | timechart count'",2018-02-07T02:56:54+00:00,
"IIS: Indicators of directory traversal, RFI and LFI -",Ronald (Access42),IIS,"The following shows IoC for directory traversal, RFI and LFI within IIS logging: ","'index=* sourcetype=""ms:iis:default""NOT (""cookie.js"" OR ""script.js"") AND (referer=""-"" OR referer="""") AND (uri_query=""*passwd*"" OR uri_query=""*cmd*"" OR uri_query=""*%00*"" OR uri_query=""*.txt*"")|table _time, clientip, status, uri_query'",2018-02-07T02:57:28+00:00,
Basic binary conversion for IPv4 Mask -,masdeeper,Hack,"Given an IP network address and it&#8217;s netmask represented under integer format, the bellow search will create a CIDR representation from the lookup without using built-in tools. &nbsp; ",,2018-03-10T05:32:18+00:00,
date_zone=local is bad -,masdeeper,Hygiene,"Impact: since there is no timezone, the logs will have the same timezone as the local user. Therefore in another timezone, the logs won&#8217;t have the same order. If no TZ is specified, perhaps we could hard code one. ","'|tstats count where index=* date_zone=local by index, sourcetype'",2018-03-10T05:32:39+00:00,
Parsing Military Time Zones -,masdeeper,Hygiene,,,2018-03-10T05:33:13+00:00,
"List skipped searches by name, reason -",masdeeper,splunkd,,'index=_internal sourcetype=scheduler\xa0savedsearch_name=* status=skipped | stats count by\xa0savedsearch_name reason',2018-03-10T05:35:57+00:00,
List of index available to your role -,masdeeper,splunkd,,'|tstats count WHERE index=* OR index=_ BY index',2018-03-10T05:36:37+00:00,
Detect Scheduler Running Twice a Search -,masdeeper,splunkd,There is a bug that make a search being executed 2 times or more. ,"'index=_internal sourcetype=scheduler scheduled_time=*\xa0savedsearch_name=* |stats count by\xa0scheduled_time,\xa0savedsearch_name | where count &gt; 1'",2018-03-10T05:35:02+00:00,2018-03-10T05:38:19+00:00
Top Offending SSH Failure by Source IP -,DaveyBoy,Monitoring,,,2018-04-24T02:29:22+00:00,
Easter egg that created sample data -,Azeemering,Fun Stuff &amp; Helpful Hints,,'\xa0| windbag',2018-04-27T02:26:42+00:00,
Compare Successful Internal Vs External Connections -,DaveyBoy,Monitoring,This query will display a bar chart of all successful Internal vs External SSH connections. Useful for identifying any spikes in connectivity coming from within your network remit or outside of it. Simply change the CIDR matches to match your required LANs. ,,2018-04-27T02:27:40+00:00,
Detect Username Guessing Brute Force Attacks -,DaveyBoy,Monitoring,,,2018-04-27T02:28:17+00:00,
Search for all errors in splunkd -,Azeemering,_internal,,,2018-05-16T01:40:46+00:00,2018-05-16T01:41:02+00:00
Search for duplicate events in Splunk -,Azeemering,Hygiene,,'index=&lt;indexname&gt; | stats count values(host) values(source) values(sourcetype) values(index) by _raw | WHERE count&gt;1',2018-05-16T01:41:30+00:00,
Search Traffic by Source IP -,pradeep577,datamodels,"GoSplunk Admin Notes: If you have a data model enabled that matches the search below, this might work for you! ","'| datamodel Network_Traffic All_Traffic search | search All_Traffic.src_ip=10.x.x.x\xa0| stats count by All_Traffic.src_ip, All_Traffic.dest,All_Traffic.action, dstcountry | dedup All_Traffic.dest'",2018-06-19T19:00:28+00:00,
Average Search Duration -,ItsJohnLocke,_internal,,"'index=_audit sourcetype=audittrail action=search total_run_time=* host=* | dedup search_id | eval runtime=if(isnum(total_run_time), total_run_time, ""null"") | where runtime!=""null"" | timechart span=15m avg(runtime) as ""Average Run Time"" by host limit=0'",2018-06-28T12:28:31+00:00,
Find success login after 10 failures with streamstats -,iv.shamanow,datamodels,If you have the Authentication data model configured you can use the following search to quickly find successful logins after 10 failed attempts! ,,2018-07-05T19:41:22+00:00,
List all fields for an index -,Azeemering,Fun Stuff &amp; Helpful Hints,A few different queries / methods to list all fields for indexes. ,"'index=yourindex| fieldsummary | table field', u'index=yourindex | stats values(*)\xa0AS\xa0*\xa0|\xa0transpose\xa0|\xa0table column\xa0|\xa0rename column AS\xa0Fieldnames', u'index=yourindex | stats dc() as * | transpose', u'index=yourindex | table *'",2018-07-17T22:38:24+00:00,
Direct and Referred Apache Web Traffic -,SplunkNinja,apache,"The following query will show all traffic to an Apache web server that is direct, meaning no referring site. ","'sourcetype=""access_combined"" referer=""-"" | stats count', u'sourcetype=""access_combined"" referer!=""-"" | stats count', u'sourcetype=""access_combined"" referer=""-"" | timechart span=1d count'",2018-07-20T19:47:55+00:00,
Apache High Level Visitor Info -,SplunkNinja,apache,The following query gives a breakdown on traffic by clientip. I run this over all time so I can get detailed information on first visit versus latest visit as you can see below. ,'| inputlookup historical_client_insight.csv',2018-07-21T21:44:38+00:00,
Add a count of events by fieldname -,Azeemering,Fun Stuff &amp; Helpful Hints,The streamstats count command creates a field called eventCount that displays the amount of events from the fieldname you specify: ,'| streamstats count as eventCount by fieldname',2018-07-24T17:40:50+00:00,
Active Directory Password change attempts -,Azeemering,WinEventLog:Security,Use the following search to create a stacked barchart of AD Password change attempts: ,"'source=""WinEventLog:Security"" ""EventCode=4723"" src_user!=""*$"" src_user!=""_svc_*"" | eval daynumber=strftime(_time,""%Y-%m-%d"") | chart count by daynumber, status | eval daynumber = mvindex(split(daynumber,""-""),2)'",2018-07-24T17:42:57+00:00,
Timechart of the status of an Locked Out Account -,Azeemering,WinEventLog:Security,This query will show a timechart of the status of an Locked Out Account ,"'sourcetype=""WinEventLog:Security"" EventCode=4625 AND Status=0xC0000234 | timechart count by user | sort -count'",2018-07-24T17:45:06+00:00,
Universal Forwarder Throughput Statistics -,Azeemering,_internal,This search creates a table to list all\xa0 Universal Forwarders. There is also an eval in there that classifies hosts based on their average Kbps. You can modify this as needed. ,,2018-07-24T20:08:32+00:00,
Top 10 Accessed Dashboards -,Azeemering,_internal,"Where &#8220;host=&#8221;your_sh_host&#8221;&#8221; you could specify a host, or put a wildcard * in place. ",,2018-07-24T21:02:50+00:00,
Universal Forwarder Throughput Limit Hit Count -,Azeemering,_internal,This search counts the amount of times the UF&#8217;s throughput limit is hit. I also threw in a sparkline: ,"'index=_internal sourcetype=splunkd ""current data throughput"" | rex ""Current data throughput \\((?&lt;kb&gt;\\S+)"" | eval rate=case(kb &lt; 500, ""256"", kb &gt; 499 AND kb &lt; 520, ""512"", kb &gt; 520 AND kb &lt; 770 ,""768"", kb&gt;771 AND kb&lt;1210, ""1024"", 1=1, ""&gt;1024"") | stats count as Count sparkline as Trend by host, rate | where Count &gt; 4 | rename host as ""Host"" rate as ""Throughput rate(kb)"" count as ""Hit Count""| sort -""Throughput rate(kb)"",-Count'",2018-07-24T21:05:07+00:00,
Show all Indexes and Sourcetypes via REST -,ItsJohnLocke,REST,The following Splunk query uses REST to display non internal indexes associated with sourcetypes. It is my understanding that this is all time (such is the way of REST searches) ,,2018-07-25T11:50:18+00:00,
Forwarder Diagnostics - Last time Data Was Received by Index and Sourcetype -,SplunkNinja,_internal,,,2016-06-17T19:09:56+00:00,2018-07-25T20:58:08+00:00
Memory Usage (MB) per Splunk Process Class -,Azeemering,_internal,Use the following search with a\xa0column chart visualisation. It will give you a good overview of what Splunk processes use the most memory: ,"'index=_introspection sourcetype=splunk_resource_usage component=PerProcess host=* | eval process = \'data.process\' | eval args = \'data.args\' | eval sid = \'data.search_props.sid\' | eval elapsed = \'data.elapsed\' | eval mem_used = \'data.mem_used\' | eval mem = \'data.mem\' | eval pct_memory = \'data.pct_memory\' | eval app = \'data.search_props.app\' | eval type = \'data.search_props.type\' | eval mode = \'data.search_props.mode\' | eval user = \'data.search_props.user\' | eval role = \'data.search_props.role\' | eval process_class = case( process==""splunk-optimize"",""index service"", process==""sh"" OR process==""ksh"" OR process==""bash"" OR like(process,""python%"") OR process==""powershell"",""scripted input"", process==""mongod"", ""KVStore"") | eval process_class = case( process==""splunkd"" AND (like(args,""-p %start%"") OR like(args,""service"")),""splunkd server"", process==""splunkd"" AND isnotnull(sid),""search"", process==""splunkd"" AND (like(args,""fsck%"") OR like(args,""recover-metadata%"") OR like(args,""cluster_thing"")),""index service"", process==""splunkd"" AND args==""instrument-resource-usage"", ""scripted input"", (like(process,""python%"") AND like(args,""%/appserver/mrsparkle/root.py%"")) OR like(process,""splunkweb""),""Splunk Web"", isnotnull(process_class), process_class) | eval process_class = if(isnull(process_class),""other"",process_class) | stats latest(data.mem_used) AS resource_usage_dedup latest(process_class) AS process_class by data.pid, _time | stats sum(resource_usage_dedup) AS resource_usage by _time, process_class | timechart minspan=10s median(resource_usage) AS ""Resource Usage"" by process_class', u''",2018-07-26T11:28:34+00:00,
Bucket Count by indexer/index -,Azeemering,_internal,This search displays the amount of buckets per indexer/index To learn more about the | dbinspect command go to: http://docs.splunk.com/Documentation/Splunk/7.1.2/SearchReference/Dbinspect ,'|dbinspect index=* | search index!=_* | chart dc(bucketId) over splunk_server by index',2018-07-26T12:17:00+00:00,
Bucket Count by State over Index -,Azeemering,_internal,This search counts the amount of buckets per state for each index. To learn more about | dbinspect go to: http://docs.splunk.com/Documentation/Splunk/7.1.2/SearchReference/Dbinspect ,"'|dbinspect index=* | eval state=case(state==""warm"" OR state==""hot"",""hot/warm"",1=1, state) | chart dc(bucketId) over index by state'",2018-07-26T12:12:49+00:00,2018-07-26T12:17:21+00:00
Show Splunk User to Role mapping -,SplunkNinja,REST,"The following Splunk REST query shows all roles, number of\xa0 capabilities, and landing app for each user. ",,2018-07-27T01:11:26+00:00,2018-07-27T01:24:57+00:00
Retention Period in days per index -,Azeemering,REST,This query will give you a table of all indexes and their respective retention period in days: ,,2018-07-31T06:35:10+00:00,
Percentage of skipped searches -,Azeemering,_internal,This query will give you a table with a percentage of skipped searches and an evaluation with 3 ranges ,"'index=_internal sourcetype=scheduler | stats count as total, count(eval(status=""skipped"")) as skipped | eval pct=round(skipped/total * 100, 0) | rangemap field=pct low=0-10, elevated=10-20 severe=20-100 | eval pct = pct . ""%"" | fields pct, range'",2018-07-31T07:31:35+00:00,2018-07-31T07:32:22+00:00
Show indexing queue sizes -,Azeemering,_internal,Use a linechart with this search to show you the indexing queue sizes: ,'index=_internal source=*metrics.log group=queue (name=parsingqueue OR name=indexqueue OR name=typingqueue OR name=aggqueue) | timechart avg(current_size) by name',2018-07-31T07:40:45+00:00,2018-07-31T07:42:15+00:00
Saved Search Scheduler Activity -,Azeemering,_internal,"I use this query a lot to tune and adjust scheduling, find out what searches need attention: ","'index=_internal sourcetype=scheduler result_count | extract pairdelim="","", kvdelim=""="", auto=f | stats avg(result_count) min(result_count) max(result_count), sparkline avg(run_time) min(run_time) max(run_time) sum(run_time) values(host) AS hosts count AS execution_count by savedsearch_name, app | join savedsearch_name type=outer | rest /servicesNS/-/-/saved/searches | fields title eai:acl.owner cron_schedule dispatch.earliest_time dispatch.latest_time search | rename title AS savedsearch_name eai:acl.app AS App eai:acl.owner AS Owner cron_schedule AS ""Cron Schedule"" dispatch.earliest_time AS ""Dispatch Earliest Time"" dispatch.latest_time AS ""Dispatch Latest Time""| rename savedsearch_name AS ""Saved Search Name"" search AS ""SPL Query"" app AS App | makemv delim="","" values(host) | sort - avg(run_time) | table ""Saved Search Name"", App, Owner, ""SPL Query"", ""Dispatch Earliest Time"" ""Dispatch Latest Time"" ""Cron Schedule"" hosts, execution_count, sparkline, *(result_count), sum(run_time) *(run_time)'",2018-07-31T11:01:18+00:00,
Indexes in Splunk -,wrangler2x,REST,,,2018-08-01T01:15:12+00:00,
License Usage Prediction -,ItsJohnLocke,_internal,"There is an older Splunk query here that had previously predicted license usage. I&#8217;m not sure why (perhaps the predict command has changed since the original post in 2015?), but the query is no longer working. I&#8217;ve updated the query to predict Splunk license usage using the Splunk predict command as shown below: ",,2018-08-02T12:24:14+00:00,
Windows security daily domain activities -,ddanielnp,WinEventLog:Security,,,2018-08-16T18:45:03+00:00,
count all events for 1 or multiple index(es) -,sedi,Monitoring,Total count of all events for 1 or more index(es) Approach 1 (fastest) ,"'| eventcount index=foo', u'| eventcount index=foo index=bar', u'| tstats count where index=foo OR index=bar by span=1d _time index'",2018-08-18T13:58:02+00:00,
Concurrent Users on Apache Web -,SplunkNinja,apache,I&#8217;ve been working through this query and depending on the length of time you are looking back you can use one of the following two methods. Option 1 &#8211; Short time window (30 days or less) concurrent users for a span of 5 minutes. ,,2018-07-13T16:50:03+00:00,2018-08-18T18:01:11+00:00
List forwarders generating socket errors due to unkown SSL protocol -,wrangler2x,_internal,,,2018-08-21T21:19:30+00:00,2018-08-22T01:41:15+00:00
"identify knowledge objects, permissions and extractions -",sedi,Uncategorized,,,2018-08-31T17:49:47+00:00,
Universal Forwarder Splunk Versions -,jaracan,_internal,Returns the version of Splunk Universal Forwarders in an environment via _internal logs. ,,2018-09-12T15:43:44+00:00,
List Deployment Apps and the associated serverClass -,wrangler2x,REST,,,2018-09-14T18:06:24+00:00,2018-09-16T19:24:48+00:00
Get Sourcetype and Index Info via TSTATS -,john117,_internal,Use the following simple tstats query to return the latest time events came in for a given index as well as list all sourcetypes for each index: ,'|tstats values(sourcetype) as Sourcetype latest(_time) as Time groupby index | convert ctime(Time)',2018-09-19T01:55:41+00:00,
List of all enabled correlation rules that generate a notable -,Rbecwar,REST,,,2018-11-03T20:29:51+00:00,
REST API response time -,SplunkNinja,_internal,This is a\xa0Splunk query to measure REST API response time from the various rest URI&#8217;s in Splunk. ,"'index=_internal sourcetype=splunkd_access source=*splunkd_access.log | rex ""- - - (?P&lt;Response_Time&gt;.*)"" | rex ""\\""(?&lt;REST_uri&gt;^\\""+)"" | table _time, REST_uri, Response_Time'",2018-11-14T19:54:43+00:00,
Show how much disk space is used by _internal -,ItsJohnLocke,_internal,The following Splunk query will return disk space used by the _internal index. ,'index=_internal source=*license_usage.log type=Usage | eval gb=b/1024/1024/1024 | timechart span=1d sum(gb) as GB by host useother=false | untable _time host gb | top limit=1 host | join time search index=_internal source=*license_usage.log type=Usage | eval gb=b/1024/1024/1024 | timechart span=1d sum(gb) as GB by sourcetype useother=false |untable _time sourcteype sum(GB)',2018-11-23T13:29:52+00:00,
Port usage for opsec sourcetype -,pradeep577,opsec,Stats count by port usage ,'index=* sourcetype=opsec | stats count by s_port proto dest dest_svc action product',2018-11-24T21:19:59+00:00,
Index Modifications -,john117,_internal,This Splunk query should show which users attempted to modify an index and if that action was successful: ,'index=_audit user=* action=indexes_edit | stats count by index info user action',2018-11-29T10:04:09+00:00,
Splunk Admin Account Activity - Account Modifications -,john117,_internal,This Splunk query shows when the admin account performed Account Modification / Deletion / Creation actions: ,'index=_audit user=admin action=edit_user operation=* | table _time user operation object*',2018-11-30T01:23:01+00:00,
Splunk Admin Account Activity - Role Modifications -,john117,_internal,This Splunk query shows when the admin account performed Create or Modify Roles actions: ,"'index=""_audit"" action=edit_roles operation=* | table _time user operation object*'",2018-11-30T01:23:26+00:00,
Forwarder TCP Connections info -,thall,_internal,This search should help identify which forwarders are connected and give you more information on the forwarders. ,"'index=""_internal"" sourcetype=""splunkd"" source=""*metrics.lo*"" group=tcpin_connections component=Metrics | eval sourceHost=if(isnull(hostname), sourceHost,hostname)| eval connectionType=case(fwdType==""uf"",""universal forwarder"", fwdType==""lwf"", ""lightweight forwarder"",fwdType==""full"", ""heavy forwarder"", connectionType==""cooked"" or connectionType==""cookedSSL"",""Splunk forwarder"", connectionType==""raw"" or connectionType==""rawSSL"",""legacy forwarder"") | eval version=if(isnull(version),""pre 4.2"",version) | eval guid=if(isnull(guid),sourceHost,guid) | eval os=if(isnull(os),""n/a"",os)| eval arch=if(isnull(arch),""n/a"",arch)| fields connectionType sourceIp sourceHost splunk_server version os arch kb guid | eval lastReceived = case(kb&gt;0, _time)| eval lastConnected=max(_time)| stats first(sourceIp) as sourceIp first(connectionType) as connectionType first(version) as version first(os) as os first(arch) as arch max(lastConnected) as lastConnected max(lastReceived) as lastReceived by sourceHost guid | addinfo | eval status=if(lastConnected&lt;(info_max_time-900),""missing"",if(mystatus=""quiet"",""quiet"",""active"")) | fields sourceHost sourceIp version connectionType os arch lastConnected lastReceived status | rename sourceHost as Forwarder version as ""Splunk Version"" connectionType as ""Forwarder Type"" os as ""Platform"" status as ""Current Status"" lastConnected as ""Last Connected"" lastReceived as ""Last Data Received"" | fieldformat ""Last Connected""=strftime(\'Last Connected\', ""%D %H:%M:%S %p"") | fieldformat ""Last Data Received""=strftime(\'Last Data Received\', ""%D %H:%M:%S %p"") | sort Forwarder'",2018-12-01T15:33:33+00:00,
System Time Modifications in Windows -,SplunkNinja,WinEventLog:Security,The following queries will return modifications to time in a windows environment. It ignores system and service accounts. Windows 2008 and newer: ,"'source=""WinEventLog:Security"" EventCode=4616 (NOT Account_Name=""*$"") (NOT Account_Name=""LOCAL SERVICE"")| eval Date=strftime(_time, ""%Y/%m/%d %H:%M:%S"")| eval oldtime = strptime(replace(Previous_Time, ""\\D"", """"), ""%Y%m%d%H%M%S%9N"") |  eval t=_time | rename t as ""eventtime"" |eval diff=round(((eventtime-oldtime)/60)/60,2) | where diff!=0| stats count by host, Account_Name, diff, Date | sort - Date| rename diff as ""Hours Between New Time and Actual Time"" |rename Account_Name as ""Source Account"" | rename host as ""Target Machine""|rename Date as ""Date and Time""| fields - count', u'source=""WinEventLog:Security"" (EventCode=520) (NOT User=""LOCAL SERVICE"") ( NOT User=""SYSTEM"") | eval Date=strftime(_time, ""%Y/%m/%d %H:%M:%S"")| eval YourDate=Previous_Time | eval epoch1=strptime(YourDate,""%H:%M:%S %p %m/%d/%Y"") | convert timeformat=""%H:%M:%S %p %m/%d/%Y"" mktime(YourDate) as oldtime |  eval t=_time | rename t as ""eventtime""| eval diff=round(((eventtime-oldtime)/60)/60,2) | where diff!=0| stats count by host, User, diff, Date | sort - Date| rename diff as ""Hours Between New Time and Actual Time"" |rename Account_Name as ""Source Account"" | rename host as ""Target Machine""|rename Date as ""Date and Time""| fields - count| fields - count'",2014-12-11T19:12:05+00:00,2018-12-04T16:12:41+00:00
Show Searches with Details (Who | When | What) -,SplunkNinja,_internal,The following Splunk search will show a list of searches ran on a splunk server with the following details: Who ran the search What sourcetype was used What index was used What the search string was When the search was last ran ,,2018-12-05T01:32:22+00:00,2018-12-05T01:49:12+00:00
User Logon / Session Duration -,SplunkNinja,WinEventLog:Security,The following query will return the duration of user logon time between initial logon and logoff events. I have a duration filter set to greater than 5 seconds to weed out any scripts that may quickly log on and log off (change this as needed to fit your environment). Windows 2008 and newer: ,"'source=WinEventLog:Security (EventCode=4624 OR EventCode=4634) (Logon_Type=2 OR Logon_Type=10) | eval Date=strftime(_time, ""%Y/%m/%d"")| eval LogonType=case(Logon_Type=""2"", ""Local Console Access"", Logon_Type=""10"", ""Remote Desktop via Terminal Services"")| transaction host user startswith=EventCode=4624 endswith=EventCode=4634 | where duration &gt; 5 | eval duration = duration/60 | eval duration=round(duration,2)| table host, user, LogonType duration, Date | rename duration as ""Session Duration in Minutes"" | sort - date', u'source=WinEventLog:Security (EventCode=528 OR EventCode=538) (Logon_Type=2 OR Logon_Type=10) | eval Date=strftime(_time, ""%Y/%m/%d"") | eval LogonType=case(Logon_Type=""2"", ""Local Console Access"", Logon_Type=""10"", ""Remote Desktop via Terminal Services"")| transaction host User startswith=EventCode=528 endswith=EventCode=538 | where duration &gt; 5 | eval duration = duration/60 | eval duration=round(duration,2)| table host, User, LogonType, duration, Date | rename duration as ""Session Duration in Minutes"" | sort - date'",2014-11-07T18:47:49+00:00,2018-12-17T15:50:01+00:00
"User Logon, Logoff, and Duration -",kme723,WinEventLog:Security,Tweaked\xa0wenthold\xa0response to include more EventCodes. Also depending on the environment EventCode 4800|4801|4802 which is screen lock may be the closest thing to getting a log off time. &gt; original post on splunk answers: https://answers.splunk.com/answers/597752/report-for-showing-users-logon-logoff-and-the-dura.html ,,2018-10-26T00:00:54+00:00,2018-12-17T15:51:33+00:00
Failed Logon Attempts - Windows -,SplunkNinja,WinEventLog:Security,The following Splunk query will show a timechart of failed logon attempts per host: ,,2018-12-17T16:56:44+00:00,2018-12-17T17:16:10+00:00
Search Common EventCodes (EventID&#039;s) for Suspicious Behavior -,Go Splunk,WinEventLog:Security,This query searches many common EventCodes (EventID&#8217;s) within a Windows environment for suspicious behavior. The query can take some time to run due to it&#8217;s length. Excellent for high-level security insight. ,,2014-10-07T14:39:03+00:00,2018-12-17T18:43:53+00:00
Successful Logons - Windows -,SplunkNinja,WinEventLog:Security,The following is a Splunk query that will display a timechart for all successful logons to windows: ,,2018-12-17T18:33:39+00:00,2018-12-17T19:15:43+00:00
Number of Hosts Associated with a Serverclass -,SplunkNinja,REST,The following query will list the number of hosts associated with all serverclasses on your Splunk Deployment server. This query should be run on your Deployment Server. ,"'| rest /services/deployment/server/clients splunk_server=local | table hostname applications.*.serverclasses | untable hostname applications | rex field=applications ""applications\\.(?&lt;apps&gt;.+)\\.serverclasses"" | stats dc(hostname) as hostname by apps'",2018-12-22T03:34:27+00:00,
Use TSTATS to find hosts no longer sending data -,SplunkNinja,_internal,,"'|tstats latest(_time) as lt by index, sourcetype, host | eval NOW=now() | eval difftime=NOW-lt', u'|tstats latest(_time) as lt by index, sourcetype, host | eval NOW=now() | eval difftime=NOW-lt | rangemap field=difftime ""0 - 60 Min""=0-3600 ""1 - 24 Hours""=3601-86400 ""1-7 Days""=86401-604800 default=""Greater than 1 Week""', u'|tstats latest(_time) as lt by index, sourcetype, host | eval NOW=now() | eval difftime=NOW-lt | where difftime&gt;=3600'",2019-01-04T00:54:07+00:00,
High Level Windows Dashboard -,SplunkNinja,Dashboards,,,2019-01-17T18:52:59+00:00,2019-01-18T11:52:59+00:00
List All Hosts Associated with All Indexes -,SplunkNinja,_internal,Using the Splunk Tstats command you can quickly list all hosts associated with all indexes: ,'|tstats values(host) where index=* by index',2016-12-22T20:51:10+00:00,2019-01-25T01:01:13+00:00
Failed Attempt to Login to a Disabled Account -,SplunkNinja,WinEventLog:Security,This Splunk Search Query will indicate any user who attempted to login to a disabled account. (Tested only on Windows 7 / Server 2008 and newer Windows logs). ,"'source=""WinEventLog:security"" EventCode=4625 (Sub_Status=""0xc0000072"" OR Sub_Status=""0xC0000072"") Security_ID!=""NULL SID"" Account_Name!=""*$"" | eval Date=strftime(_time, ""%Y/%m/%d"")| rex ""Which\\sLogon\\sFailed:\\s+\\S+\\s\\S+\\s+\\S+\\s+Account\\sName:\\s+(?&lt;facct&gt;\\S+)"" | eval Date=strftime(_time, ""%Y/%m/%d"") | stats count by Date, facct, host, Keywords | rename facct as ""Target Account"" host as ""Host"" Keywords as ""Status"" count as ""Count""'",2016-02-04T12:14:11+00:00,2019-01-25T01:05:03+00:00
Searching Your Searches -,kdor,Dashboards,"Below is the raw XML of a dashboard we wrote about on our blog a couple of months ago. Click here to read that blog, or copy/paste this XML in your Splunk instance! ",,2019-01-29T14:47:02+00:00,
Auditd hosts in all environments -,manderso,Dashboards,"Shows the login activity to our linux environments, sudo commands per host and users. Admin Notes: index=main was changed to index=* due to not everyone using the same index. This dashboard has been tested for code errors, but not for search errors.\xa0Please comment if you have any issues! \xa0 ",,2019-01-29T16:23:30+00:00,2019-01-29T17:11:43+00:00
Simple File Integrity Monitoring Management Dashboard -,splunkzilla,Dashboards,,,2019-02-01T19:33:29+00:00,2019-02-02T16:36:41+00:00
